<!do<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SNBT Fighter Journey</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
    }
    .card-glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    .btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
    }
    .tab-active {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
      color: white;
    }
    .progress-ring {
      transform: rotate(-90deg);
    }
    .habit-item {
      transition: all 0.3s ease;
    }
    .habit-item:hover {
      transform: translateX(5px);
    }
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.8); }
    }
    .countdown-glow {
      animation: pulse-glow 2s infinite;
    }
    .toast {
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .calendar-mini {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 4px;
    }
    .calendar-mini-day {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg">
  <div id="app" class="h-full overflow-auto"><!-- Toast Container -->
   <div id="toast-container" class="fixed top-4 right-4 z-50"></div><!-- Login Screen -->
   <div id="login-screen" class="min-h-full flex items-center justify-center p-4">
    <div class="card-glass rounded-3xl p-8 w-full max-w-md shadow-2xl">
     <div class="text-center mb-8">
      <div class="text-6xl mb-4">
       ğŸ¯
      </div>
      <h1 id="app-title" class="text-3xl font-bold text-gray-800 mb-2">SNBT Fighter Journey</h1>
      <p class="text-gray-600">Perjalanan Menuju Sukses SNBT 2026</p>
     </div><!-- Login Form -->
     <div id="login-form">
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Masukkan PIN</label> <input type="password" id="pin-input" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div><button id="login-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> Masuk </button>
      <div id="login-error" class="text-red-500 text-center text-sm mb-4 hidden"></div>
      <div class="border-t pt-4 mt-4">
       <p class="text-gray-600 text-sm text-center mb-3">ğŸ“± Dapatkan PIN dengan menghubungi kami:</p><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="block text-center text-amber-600 font-medium hover:text-amber-700 underline"> lynk.id/suksesbarengjalurlangit </a>
      </div>
      <div class="flex gap-2 mt-6"><button id="show-pins-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-xl transition text-sm"> ğŸ‘ï¸ Lihat PIN </button> <button id="show-admin-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-xl transition text-sm"> ğŸ” Admin </button>
      </div>
     </div><!-- View Pins -->
     <div id="view-pins" class="hidden">
      <h3 class="text-lg font-bold text-gray-800 mb-4">PIN Terdaftar</h3>
      <div id="pins-list" class="max-h-60 overflow-y-auto space-y-2 mb-4"></div><button id="back-from-pins" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> â† Kembali </button>
     </div><!-- Admin Panel -->
     <div id="admin-panel" class="hidden">
      <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ” Kelola PIN</h3>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Kode Admin</label> <input type="password" id="admin-code" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="Masukkan kode admin">
      </div>
      <div id="pin-creation" class="hidden">
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Username</label> <input type="text" id="new-username" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="Nama pengguna">
       </div>
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Baru (4 digit)</label> <input type="text" id="new-pin" maxlength="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
       </div><button id="create-pin-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-2"> Buat PIN </button>
      </div><button id="verify-admin-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-2"> Verifikasi </button> <button id="back-from-admin" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> â† Kembali </button>
     </div>
    </div>
   </div><!-- Main Dashboard -->
   <div id="main-dashboard" class="hidden min-h-full"><!-- Header -->
    <header class="bg-white/95 backdrop-blur-lg shadow-lg sticky top-0 z-40">
     <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-3"><span class="text-3xl">ğŸ¯</span>
       <div>
        <h1 class="font-bold text-gray-800">SNBT Fighter</h1>
        <p id="user-welcome" class="text-xs text-gray-500"></p>
       </div>
      </div>
      <div class="flex gap-2"><button id="change-pin-btn" class="bg-amber-100 hover:bg-amber-200 text-amber-700 px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ”‘ Ganti PIN </button> <button id="logout-btn" class="bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg text-sm font-medium transition"> Keluar </button>
      </div>
     </div>
    </header><!-- Change PIN Modal -->
    <div id="change-pin-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
     <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ”‘ Ganti PIN</h3>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Lama</label> <input type="password" id="old-pin-input" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Baru</label> <input type="password" id="new-pin-change" maxlength="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div>
      <div class="flex gap-2"><button id="cancel-change-pin" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> Batal </button> <button id="save-change-pin" class="flex-1 btn-primary text-white font-medium py-2 rounded-xl"> Simpan </button>
      </div>
     </div>
    </div><!-- Notification Permission Request -->
    <div id="notification-banner" class="hidden bg-blue-100 border-l-4 border-blue-500 p-4 m-4 rounded">
     <div class="flex justify-between items-center">
      <div class="text-sm text-blue-700"><strong>ğŸ”” Aktifkan Notifikasi</strong> untuk mendapat reminder habit Anda
      </div><button id="enable-notifications-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm font-medium"> Aktifkan </button>
     </div>
    </div><!-- Tabs Navigation -->
    <nav class="bg-white/90 backdrop-blur-lg border-b sticky top-16 z-30">
     <div class="max-w-7xl mx-auto px-2">
      <div class="flex overflow-x-auto no-scrollbar"><button class="tab-btn tab-active flex-shrink-0 px-4 py-3 font-medium text-sm rounded-t-lg transition" data-tab="dashboard"> ğŸ“Š Dashboard </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="timer"> ï¿½ï¿½ï¿½ï¸ Timer </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="latihan"> ğŸ“ Latihan </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="game-kata"> ğŸ”¤ Game Kata </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="game-math"> ğŸ§® Game Math </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="statistik"> ğŸ“ˆ Statistik </button>
      </div>
     </div>
    </nav><!-- Tab Contents -->
    <main class="max-w-7xl mx-auto p-4"><!-- Dashboard Tab -->
     <div id="tab-dashboard" class="tab-content pb-16"><!-- Countdown Section -->
      <div class="card-glass rounded-2xl p-6 mb-6 shadow-xl">
       <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">â³ Countdown Menuju SNBT 2026</h2>
       <div class="flex flex-wrap justify-center gap-4 mb-6">
        <div class="bg-gradient-to-br from-amber-400 to-amber-600 text-white rounded-2xl p-4 min-w-24 text-center countdown-glow">
         <div id="countdown-days" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Hari
         </div>
        </div>
        <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-hours" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Jam
         </div>
        </div>
        <div class="bg-gradient-to-br from-green-500 to-green-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-minutes" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Menit
         </div>
        </div>
        <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-seconds" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Detik
         </div>
        </div>
       </div><!-- Progress Bar -->
       <div class="mb-4">
        <div class="flex justify-between text-sm text-gray-600 mb-2"><span>Progress Perjalanan</span> <span id="progress-percent">0%</span>
        </div>
        <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
         <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>2 Feb 2026</span> <span>21 Apr 2026</span>
        </div>
       </div>
      </div><!-- Habits & Mood Section -->
      <div class="card-glass rounded-2xl p-6 shadow-xl mb-6">
       <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“‹ Habit Harian</h3><!-- Date Selection -->
       <div class="mb-4 p-3 bg-blue-50 rounded-lg border-2 border-blue-200"><label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“… Pilih Tanggal Habit</label>
        <div class="flex gap-2 items-center"><input type="date" id="habit-date-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-blue-300 focus:border-amber-500 focus:outline-none text-sm"> <button id="view-habit-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">ğŸ‘ï¸ Lihat</button> <button id="today-habit-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">ğŸ“† Hari Ini</button>
        </div>
        <p id="habit-date-display" class="text-xs text-gray-500 mt-2"></p>
       </div><!-- Add Daily Habit -->
       <div class="flex gap-2 mb-4 flex-wrap"><input type="text" id="new-habit-input" class="flex-1 min-w-40 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Tambah habit..."> <input type="time" id="habit-time-input" class="px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm"> <button id="add-daily-habit-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
       </div><!-- Daily Habits List -->
       <div id="daily-habits-list" class="max-h-40 overflow-y-auto space-y-2 mb-4"></div><!-- Mood Selection -->
       <div class="border-t pt-4 mb-4">
        <h4 class="font-medium text-gray-700 mb-2">ğŸ­ Mood Hari Ini</h4>
        <div class="flex gap-2 flex-wrap"><button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜Š">ğŸ˜Š</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜">ğŸ˜</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜”">ğŸ˜”</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜¤">ğŸ˜¤</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ”¥">ğŸ”¥</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ’ª">ğŸ’ª</button>
        </div>
        <p id="selected-mood" class="text-sm text-gray-500 mt-2"></p>
       </div><button id="save-daily-habit-btn" class="w-full btn-primary text-white font-medium py-2 rounded-xl"> ğŸ’¾ Simpan Habit &amp; Mood </button>
      </div><!-- Mini Calendar -->
      <div class="card-glass rounded-2xl p-6 shadow-xl mb-6">
       <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“… Kalender Perjalanan SNBT (Hari 1-80)</h3>
       <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">2 Februari - 21 April 2026</span>
        <div class="text-sm text-gray-500" id="calendar-progress">
         Hari 1 - 80
        </div>
       </div>
       <div class="calendar-mini" id="mini-calendar"></div>
      </div><!-- Footer -->
      <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-6 text-center">
       <p class="text-sm text-gray-700 mb-3">ğŸ“± Follow kami di Instagram</p><a href="https://www.instagram.com/ferdiansyah_ypf/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 mb-4 hover:opacity-80 transition">
        <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.322a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z" />
        </svg><span class="font-bold text-amber-600">@ferdiansyah_ypf</span> </a>
       <p class="text-xs text-gray-600 mb-3">Temukan produk bermanfaat lainnya:</p>
       <div class="flex gap-2 justify-center"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ”— Kunjungi Web </a> <button id="copy-url-dashboard" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ“‹ Copy URL </button>
       </div>
      </div>
     </div><!-- Timer Tab -->
     <div id="tab-timer" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">â±ï¸ Timer Belajar</h2><!-- Subject Selection -->
       <div class="mb-6"><label class="block text-gray-700 font-medium mb-2">Mata Pelajaran SNBT</label> <select id="timer-subject" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none"> <option value="">Pilih Mata Pelajaran</option> <option value="Penalaran Umum">Penalaran Umum</option> <option value="Pengetahuan Kuantitatif">Pengetahuan Kuantitatif</option> <option value="Pengetahuan dan Pemahaman Umum">Pengetahuan dan Pemahaman Umum</option> <option value="Kemampuan Memahami Bacaan dan Menulis">Kemampuan Memahami Bacaan dan Menulis</option> <option value="Literasi Bahasa Indonesia">Literasi Bahasa Indonesia</option> <option value="Literasi Bahasa Inggris">Literasi Bahasa Inggris</option> <option value="Penalaran Matematika">Penalaran Matematika</option> </select>
       </div><!-- Countdown Timer Setup -->
       <div class="bg-blue-50 rounded-2xl p-4 mb-6">
        <h3 class="font-bold text-gray-800 mb-3">â³ Timer Hitung Mundur (Opsional)</h3>
        <div class="grid grid-cols-3 gap-3 mb-3">
         <div><label class="block text-sm text-gray-600 mb-1">Jam</label> <input type="number" id="timer-hours-input" min="0" max="23" value="0" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
         <div><label class="block text-sm text-gray-600 mb-1">Menit</label> <input type="number" id="timer-minutes-input" min="0" max="59" value="30" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
         <div><label class="block text-sm text-gray-600 mb-1">Detik</label> <input type="number" id="timer-seconds-input" min="0" max="59" value="0" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
        </div><button id="set-timer-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 rounded-lg"> â±ï¸ Gunakan Timer Hitung Mundur </button>
       </div><!-- Timer Display (Regular) -->
       <div class="text-center mb-6">
        <div class="text-7xl font-bold text-gray-800 font-mono mb-4"><span id="timer-hours">00</span>:<span id="timer-minutes">00</span>:<span id="timer-seconds">00</span>
        </div>
        <p id="timer-mode-label" class="text-sm text-gray-500 mb-3">Timer Hitung Maju</p>
        <div class="flex justify-center gap-3"><button id="timer-start" class="bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-3 rounded-xl transition"> â–¶ Mulai </button> <button id="timer-pause" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-6 py-3 rounded-xl transition"> â¸ Jeda </button> <button id="timer-reset" class="bg-red-500 hover:bg-red-600 text-white font-bold px-6 py-3 rounded-xl transition"> ğŸ”„ Reset </button>
        </div>
       </div><!-- Notes -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">ğŸ“ Catatan &amp; Refleksi</label> <textarea id="timer-notes" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none h-32 resize-none" placeholder="Tulis catatan atau refleksi saat belajar..."></textarea>
       </div><button id="save-timer-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Sesi Belajar </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-timer" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Latihan Tab -->
     <div id="tab-latihan" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“ Latihan Soal SNBT</h2><!-- Subject Selection -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Mata Pelajaran</label> <select id="latihan-subject" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none"> <option value="">Pilih Mata Pelajaran</option> <option value="Penalaran Umum">Penalaran Umum</option> <option value="Pengetahuan Kuantitatif">Pengetahuan Kuantitatif</option> <option value="Pengetahuan dan Pemahaman Umum">Pengetahuan dan Pemahaman Umum</option> <option value="Kemampuan Memahami Bacaan dan Menulis">Kemampuan Memahami Bacaan dan Menulis</option> <option value="Literasi Bahasa Indonesia">Literasi Bahasa Indonesia</option> <option value="Literasi Bahasa Inggris">Literasi Bahasa Inggris</option> <option value="Penalaran Matematika">Penalaran Matematika</option> </select>
       </div><!-- Timer -->
       <div class="bg-gray-100 rounded-xl p-4 mb-4">
        <div class="text-center mb-3"><span class="text-3xl font-bold font-mono text-gray-800"> <span id="latihan-timer-min">00</span>:<span id="latihan-timer-sec">00</span> </span>
        </div>
        <div class="flex justify-center gap-2"><button id="latihan-start" class="bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">â–¶ Mulai</button> <button id="latihan-pause" class="bg-amber-500 hover:bg-amber-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">â¸ Jeda</button> <button id="latihan-reset" class="bg-red-500 hover:bg-red-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">ğŸ”„ Reset</button>
        </div>
       </div><!-- Score -->
       <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-green-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-green-600" id="latihan-correct">
          0
         </div>
         <div class="text-sm text-green-700">
          âœ“ Benar
         </div>
         <div class="flex justify-center gap-2 mt-2"><button id="correct-minus" class="bg-green-200 hover:bg-green-300 text-green-700 w-8 h-8 rounded-lg font-bold">-</button> <button id="correct-plus" class="bg-green-200 hover:bg-green-300 text-green-700 w-8 h-8 rounded-lg font-bold">+</button>
         </div>
        </div>
        <div class="bg-red-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-red-600" id="latihan-wrong">
          0
         </div>
         <div class="text-sm text-red-700">
          âœ— Salah
         </div>
         <div class="flex justify-center gap-2 mt-2"><button id="wrong-minus" class="bg-red-200 hover:bg-red-300 text-red-700 w-8 h-8 rounded-lg font-bold">-</button> <button id="wrong-plus" class="bg-red-200 hover:bg-red-300 text-red-700 w-8 h-8 rounded-lg font-bold">+</button>
         </div>
        </div>
       </div><!-- Notes -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">ğŸ“ Catatan</label> <textarea id="latihan-notes" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none h-24 resize-none" placeholder="Catatan tentang latihan soal..."></textarea>
       </div><button id="save-latihan-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Latihan </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-latihan" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Game Kata Tab -->
     <div id="tab-game-kata" class="tab-content hidden pb-16">
      <div class="grid md:grid-cols-2 gap-6"><!-- Kata Baku -->
       <div class="card-glass rounded-2xl p-6 shadow-xl">
        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“– Game Kata Baku</h3>
        <p class="text-sm text-gray-600 mb-4">Tambahkan kata baku dan tidak baku untuk belajar!</p>
        <div class="flex gap-2 mb-4"><input type="text" id="kata-baku-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Kata baku"> <input type="text" id="kata-tidak-baku-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Tidak baku"> <button id="add-kata-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
        </div>
        <div id="kata-list" class="max-h-48 overflow-y-auto space-y-2 mb-4"></div><button id="play-kata-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition"> ğŸ® Main Game Kata Baku </button> <!-- Game Area -->
        <div id="kata-game-area" class="hidden mt-4 bg-gray-100 rounded-xl p-4">
         <div class="text-center mb-4">
          <p class="text-sm text-gray-600 mb-2">Pilih kata yang BAKU:</p>
          <div id="kata-question" class="text-xl font-bold text-gray-800 mb-4"></div>
          <div id="kata-options" class="flex gap-3 justify-center flex-wrap"></div>
         </div>
         <div class="flex justify-between text-sm"><span class="text-green-600">âœ“ Benar: <span id="kata-score-correct">0</span></span> <span class="text-red-600">âœ— Salah: <span id="kata-score-wrong">0</span></span>
         </div>
        </div>
       </div><!-- Vocabulary English -->
       <div class="card-glass rounded-2xl p-6 shadow-xl">
        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ”¤ Vocabulary English</h3>
        <p class="text-sm text-gray-600 mb-4">Tambahkan kosakata bahasa Inggris!</p>
        <div class="flex gap-2 mb-4"><input type="text" id="vocab-eng-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="English"> <input type="text" id="vocab-ind-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Indonesia"> <button id="add-vocab-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
        </div>
        <div id="vocab-list" class="max-h-48 overflow-y-auto space-y-2 mb-4"></div><button id="play-vocab-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl transition"> ğŸ® Main Vocabulary Game </button> <!-- Game Area -->
        <div id="vocab-game-area" class="hidden mt-4 bg-gray-100 rounded-xl p-4">
         <div class="text-center mb-4">
          <p class="text-sm text-gray-600 mb-2">Apa arti kata ini?</p>
          <div id="vocab-question" class="text-xl font-bold text-gray-800 mb-4"></div>
          <div id="vocab-options" class="flex gap-3 justify-center flex-wrap"></div>
         </div>
         <div class="flex justify-between text-sm"><span class="text-green-600">âœ“ Benar: <span id="vocab-score-correct">0</span></span> <span class="text-red-600">âœ— Salah: <span id="vocab-score-wrong">0</span></span>
         </div>
        </div>
       </div>
      </div><!-- Footer -->
      <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm mt-6">
       <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
       <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
       <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
       <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-kata" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
       </div>
      </div>
     </div><!-- Game Math Tab -->
     <div id="tab-game-math" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-4xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ§® Game Matematika</h2><!-- Game Selection -->
       <div class="grid md:grid-cols-2 gap-6 mb-6"><!-- Hitung Cepat -->
        <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-2xl p-6">
         <h3 class="text-xl font-bold mb-2">âš¡ Hitung Cepat</h3>
         <p class="text-sm opacity-90 mb-4">Jawab soal matematika secepat mungkin!</p>
         <div class="mb-4"><label class="block text-sm font-medium mb-2">Level:</label> <select id="hitung-level" class="w-full px-3 py-2 rounded-lg text-gray-800"> <option value="mudah">Mudah (+ - Ã—)</option> <option value="sedang">Sedang (+ - Ã— Ã·)</option> <option value="sulit">Sulit (+ - Ã— Ã· ^ âˆš)</option> </select>
         </div><button id="start-hitung-btn" class="w-full bg-white text-blue-600 font-bold py-3 rounded-xl hover:bg-blue-50 transition"> ğŸ® Mulai Hitung Cepat </button>
        </div><!-- Memory Game -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-2xl p-6">
         <h3 class="text-xl font-bold mb-2">ğŸ§  Memory Match</h3>
         <p class="text-sm opacity-90 mb-4">Cocokkan operasi dengan hasilnya!</p>
         <div class="mb-4"><label class="block text-sm font-medium mb-2">Level:</label> <select id="memory-level" class="w-full px-3 py-2 rounded-lg text-gray-800"> <option value="mudah">Mudah (4 pasang)</option> <option value="sedang">Sedang (6 pasang)</option> <option value="sulit">Sulit (8 pasang)</option> </select>
         </div><button id="start-memory-btn" class="w-full bg-white text-purple-600 font-bold py-3 rounded-xl hover:bg-purple-50 transition"> ğŸ® Mulai Memory Game </button>
        </div>
       </div><!-- Hitung Cepat Game Area -->
       <div id="hitung-game-area" class="hidden bg-gray-100 rounded-2xl p-6 mb-4">
        <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">Level: <span id="hitung-current-level"></span></span> <span class="text-sm font-medium text-gray-600">Waktu: <span id="hitung-timer" class="font-mono">60</span>s</span>
        </div>
        <div class="text-center mb-6">
         <div id="hitung-question" class="text-4xl font-bold text-gray-800 mb-4">
          5 + 3 = ?
         </div><input type="number" id="hitung-answer" class="w-32 px-4 py-3 text-2xl text-center rounded-xl border-2 border-gray-300 focus:border-amber-500 focus:outline-none" placeholder="?"> <button id="hitung-submit" class="ml-2 btn-primary text-white font-bold px-6 py-3 rounded-xl">Jawab</button>
        </div>
        <div class="flex justify-center gap-6"><span class="text-green-600 font-bold">âœ“ <span id="hitung-correct">0</span></span> <span class="text-red-600 font-bold">âœ— <span id="hitung-wrong">0</span></span>
        </div>
       </div><!-- Memory Game Area -->
       <div id="memory-game-area" class="hidden bg-gray-100 rounded-2xl p-6 mb-4">
        <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">Level: <span id="memory-current-level"></span></span> <span class="text-sm font-medium text-gray-600">Langkah: <span id="memory-moves">0</span></span>
        </div>
        <div id="memory-grid" class="grid gap-3 justify-center"></div>
        <div class="text-center mt-4"><span class="text-green-600 font-bold">Cocok: <span id="memory-matches">0</span></span>
        </div>
       </div><!-- Save Score --> <button id="save-math-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Skor Game </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-math" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Statistik Tab -->
     <div id="tab-statistik" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“ˆ Statistik &amp; Riwayat</h2><!-- Summary Stats -->
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-blue-600" id="stat-study-hours">
          0
         </div>
         <div class="text-sm text-blue-700">
          Jam Belajar
         </div>
        </div>
        <div class="bg-green-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-green-600" id="stat-latihan">
          0
         </div>
         <div class="text-sm text-green-700">
          Latihan Soal
         </div>
        </div>
        <div class="bg-amber-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-amber-600" id="stat-games">
          0
         </div>
         <div class="text-sm text-amber-700">
          Game Dimainkan
         </div>
        </div>
        <div class="bg-purple-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-purple-600" id="stat-habits">
          0
         </div>
         <div class="text-sm text-purple-700">
          Habit Selesai
         </div>
        </div>
       </div><!-- History List -->
       <div class="mb-4">
        <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ“œ Riwayat Aktivitas</h3>
        <div class="flex gap-2 mb-4 flex-wrap"><button class="filter-btn bg-gray-800 text-white px-3 py-1 rounded-lg text-sm" data-filter="all">Semua</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="timer">Timer</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="latihan">Latihan</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="game">Game</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="habit">Habit</button>
        </div>
        <div id="history-list" class="max-h-96 overflow-y-auto space-y-3 mb-4"></div>
       </div><!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-stat" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div>
    </main>
   </div>
  </div>
  <script>
    // App State
    let currentUser = null;
    let allData = [];
    let currentDailyHabits = [];
    let currentDailyMood = '';
    let timerInterval = null;
    let timerSeconds = 0;
    let countdownMode = false;
    let countdownTotal = 0;
    let latihanTimerInterval = null;
    let latihanSeconds = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let kataList = [];
    let vocabList = [];
    let kataGameScore = { correct: 0, wrong: 0 };
    let vocabGameScore = { correct: 0, wrong: 0 };
    let hitungGameActive = false;
    let hitungTimer = 60;
    let hitungInterval = null;
    let hitungScore = { correct: 0, wrong: 0 };
    let memoryCards = [];
    let memoryFlipped = [];
    let memoryMatched = [];
    let memoryMoves = 0;
    let currentFilter = 'all';

    const defaultConfig = {
      app_title: 'SNBT Fighter Journey'
    };

    const SNBT_START = new Date('2026-02-02');
    const SNBT_END = new Date('2026-04-21');
    const TOTAL_DAYS = 80;

    // Element SDK Init
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const title = config.app_title || defaultConfig.app_title;
          document.getElementById('app-title').textContent = title;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title]
        ])
      });
    }

    // Data SDK Init
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        updateUI();
      }
    };

    async function initDataSDK() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Gagal menginisialisasi data', 'error');
        }
      }
    }

    initDataSDK();

    // Toast Notification
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast px-4 py-3 rounded-lg shadow-lg mb-2 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-amber-500'} text-white font-medium`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Get Users/PINs
    function getUsers() {
      return allData.filter(d => d.type === 'user');
    }

    // Update UI based on data
    function updateUI() {
      updateStats();
      renderPinList();
    }

    // Render PIN List
    function renderPinList() {
      const container = document.getElementById('pins-list');
      const users = getUsers();
      
      if (users.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada PIN terdaftar</p>';
        return;
      }

      container.innerHTML = users.map(u => `
        <div class="bg-gray-100 rounded-lg p-3 flex justify-between items-center">
          <span class="font-medium text-gray-800">${u.username}</span>
          <span class="font-mono text-gray-500">****</span>
        </div>
      `).join('');
    }

    // Copy URL Function
    function copyToClipboard(url) {
      navigator.clipboard.writeText(url).then(() => {
        showToast('URL berhasil disalin!', 'success');
      }).catch(() => {
        showToast('Gagal menyalin URL', 'error');
      });
    }

    document.querySelectorAll('[id^="copy-url-"]').forEach(btn => {
      btn.addEventListener('click', () => {
        copyToClipboard('https://lynk.id/suksesbarengjalurlangit');
      });
    });

    // Login Functions
    document.getElementById('login-btn').addEventListener('click', async () => {
      const pin = document.getElementById('pin-input').value;
      const users = getUsers();
      const user = users.find(u => u.pin === pin);

      if (user) {
        currentUser = user;
        document.getElementById('user-welcome').textContent = `Halo, ${user.username}!`;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-dashboard').classList.remove('hidden');
        
        // Check notification permission
        if ('Notification' in window && Notification.permission === 'default') {
          document.getElementById('notification-banner').classList.remove('hidden');
        }
        
        initDashboard();
        document.getElementById('login-error').classList.add('hidden');
      } else {
        document.getElementById('login-error').textContent = 'PIN tidak valid!';
        document.getElementById('login-error').classList.remove('hidden');
      }
    });

    document.getElementById('enable-notifications-btn').addEventListener('click', () => {
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            showToast('Notifikasi berhasil diaktifkan!', 'success');
            document.getElementById('notification-banner').classList.add('hidden');
          }
        });
      }
    });

    // Show PINs
    document.getElementById('show-pins-btn').addEventListener('click', () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('view-pins').classList.remove('hidden');
      renderPinList();
    });

    document.getElementById('back-from-pins').addEventListener('click', () => {
      document.getElementById('view-pins').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
    });

    // Admin Panel
    document.getElementById('show-admin-btn').addEventListener('click', () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
    });

    document.getElementById('back-from-admin').addEventListener('click', () => {
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('pin-creation').classList.add('hidden');
      document.getElementById('verify-admin-btn').classList.remove('hidden');
      document.getElementById('admin-code').value = '';
    });

    document.getElementById('verify-admin-btn').addEventListener('click', () => {
      const code = document.getElementById('admin-code').value;
      if (code === '2399') {
        document.getElementById('pin-creation').classList.remove('hidden');
        document.getElementById('verify-admin-btn').classList.add('hidden');
        showToast('Verifikasi berhasil!', 'success');
      } else {
        showToast('Kode admin salah!', 'error');
      }
    });

    document.getElementById('create-pin-btn').addEventListener('click', async () => {
      const username = document.getElementById('new-username').value.trim();
      const pin = document.getElementById('new-pin').value.trim();

      if (!username || !pin || pin.length !== 4 || !/^\d+$/.test(pin)) {
        showToast('Username dan PIN 4 digit angka diperlukan!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'user',
        username: username,
        pin: pin,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('PIN berhasil dibuat!', 'success');
        document.getElementById('new-username').value = '';
        document.getElementById('new-pin').value = '';
      } else {
        showToast('Gagal membuat PIN', 'error');
      }
    });

    // Change PIN
    document.getElementById('change-pin-btn').addEventListener('click', () => {
      document.getElementById('change-pin-modal').classList.remove('hidden');
    });

    document.getElementById('cancel-change-pin').addEventListener('click', () => {
      document.getElementById('change-pin-modal').classList.add('hidden');
    });

    document.getElementById('save-change-pin').addEventListener('click', async () => {
      const oldPin = document.getElementById('old-pin-input').value;
      const newPin = document.getElementById('new-pin-change').value;

      if (oldPin !== currentUser.pin) {
        showToast('PIN lama salah!', 'error');
        return;
      }

      if (newPin.length !== 4 || !/^\d+$/.test(newPin)) {
        showToast('PIN baru harus 4 digit angka!', 'error');
        return;
      }

      const updatedUser = { ...currentUser, pin: newPin };
      const result = await window.dataSdk.update(updatedUser);

      if (result.isOk) {
        currentUser = updatedUser;
        showToast('PIN berhasil diubah!', 'success');
        document.getElementById('change-pin-modal').classList.add('hidden');
        document.getElementById('old-pin-input').value = '';
        document.getElementById('new-pin-change').value = '';
      } else {
        showToast('Gagal mengubah PIN', 'error');
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('main-dashboard').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('pin-input').value = '';
      resetTimers();
    });

    // Tab Navigation
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('tab-active');
          b.classList.add('text-gray-600');
        });
        btn.classList.add('tab-active');
        btn.classList.remove('text-gray-600');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`tab-${btn.dataset.tab}`).classList.remove('hidden');
      });
    });

    // Initialize Dashboard
    function initDashboard() {
      updateCountdown();
      setInterval(updateCountdown, 1000);
      renderMiniCalendar();
      initHabitDatePicker();
    }

    // Countdown
    function updateCountdown() {
      const snbtDate = new Date('2026-04-21T00:00:00');
      const now = new Date();
      const diff = snbtDate - now;

      if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('countdown-days').textContent = days;
        document.getElementById('countdown-hours').textContent = hours;
        document.getElementById('countdown-minutes').textContent = minutes;
        document.getElementById('countdown-seconds').textContent = seconds;
      }

      // Progress calculation
      const totalDays = (SNBT_END - SNBT_START) / (1000 * 60 * 60 * 24);
      const passedDays = Math.max(0, (now - SNBT_START) / (1000 * 60 * 60 * 24));
      const progress = Math.min(100, Math.max(0, (passedDays / totalDays) * 100));
      
      document.getElementById('progress-percent').textContent = `${progress.toFixed(1)}%`;
      document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    // Mini Calendar (Days 1-80)
    function renderMiniCalendar() {
      const grid = document.getElementById('mini-calendar');
      grid.innerHTML = '';

      for (let day = 1; day <= TOTAL_DAYS; day++) {
        const dateObj = new Date(SNBT_START);
        dateObj.setDate(dateObj.getDate() + day - 1);
        const dateStr = dateObj.toISOString().split('T')[0];
        
        const hasHabit = allData.some(d => d.type === 'habit' && d.date === dateStr && d.username === currentUser?.username);
        const isToday = dateStr === new Date().toISOString().split('T')[0];

        const dayEl = document.createElement('div');
        dayEl.className = `calendar-mini-day cursor-pointer ${isToday ? 'bg-amber-400 text-white font-bold ring-2 ring-amber-600' : hasHabit ? 'bg-green-400 text-white font-bold' : 'bg-gray-200 text-gray-700'} hover:scale-110 transition-transform`;
        dayEl.textContent = day;
        dayEl.title = dateStr;
        
        dayEl.addEventListener('click', () => {
          document.getElementById('habit-date-input').value = dateStr;
          selectedHabitDate = dateStr;
          isViewingMode = true;
          updateHabitDateDisplay();
          loadDailyHabit();
          document.querySelector('[data-tab="dashboard"]').click();
          showToast(`ğŸ“… Menampilkan habit: ${dateStr}`, 'success');
        });

        grid.appendChild(dayEl);
      }
    }

    // Daily Habits (saved once per day)
    let selectedHabitDate = new Date().toISOString().split('T')[0];
    let isViewingMode = false;

    function initHabitDatePicker() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('habit-date-input').value = today;
      selectedHabitDate = today;
      updateHabitDateDisplay();
      loadDailyHabit();
    }

    function updateHabitDateDisplay() {
      const dateObj = new Date(selectedHabitDate + 'T00:00:00');
      const dateStr = dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      document.getElementById('habit-date-display').textContent = `Menampilkan habit: ${dateStr}`;
    }

    document.getElementById('habit-date-input').addEventListener('change', (e) => {
      selectedHabitDate = e.target.value;
      isViewingMode = true;
      updateHabitDateDisplay();
      loadDailyHabit();
    });

    document.getElementById('view-habit-btn').addEventListener('click', () => {
      const dateInput = document.getElementById('habit-date-input').value;
      if (dateInput) {
        selectedHabitDate = dateInput;
        isViewingMode = true;
        updateHabitDateDisplay();
        loadDailyHabit();
      }
    });

    document.getElementById('today-habit-btn').addEventListener('click', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('habit-date-input').value = today;
      selectedHabitDate = today;
      isViewingMode = false;
      updateHabitDateDisplay();
      loadDailyHabit();
    });

    document.getElementById('add-daily-habit-btn').addEventListener('click', () => {
      if (isViewingMode && selectedHabitDate !== new Date().toISOString().split('T')[0]) {
        showToast('Hanya bisa menambah habit hari ini!', 'error');
        return;
      }

      const text = document.getElementById('new-habit-input').value.trim();
      const time = document.getElementById('habit-time-input').value;
      
      if (text) {
        currentDailyHabits.push({ text, time, done: false, id: Date.now() });
        renderDailyHabits();
        document.getElementById('new-habit-input').value = '';
        document.getElementById('habit-time-input').value = '';
      }
    });

    function renderDailyHabits() {
      const container = document.getElementById('daily-habits-list');
      if (currentDailyHabits.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm py-2">Belum ada habit</p>';
        return;
      }

      container.innerHTML = currentDailyHabits.map((h, i) => `
        <div class="flex items-center gap-2 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-3 border-l-4 border-blue-500">
          <input type="checkbox" ${h.done ? 'checked' : ''} onchange="toggleDailyHabit(${i})" class="w-4 h-4 text-amber-500 rounded cursor-pointer">
          <div class="flex-1">
            <span class="${h.done ? 'line-through text-gray-400' : 'text-gray-800'} font-medium text-sm">${h.text}</span>
            ${h.time ? `<span class="text-xs text-gray-500 ml-2">ğŸ• ${h.time}</span>` : ''}
          </div>
          <button onclick="deleteDailyHabit(${i})" class="text-red-400 hover:text-red-600 text-sm font-bold transition">Ã—</button>
        </div>
      `).join('');
    }

    window.toggleDailyHabit = function(index) {
      currentDailyHabits[index].done = !currentDailyHabits[index].done;
      renderDailyHabits();
    };

    window.deleteDailyHabit = function(index) {
      currentDailyHabits.splice(index, 1);
      renderDailyHabits();
    };

    // Mood Selection
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentDailyMood = btn.dataset.mood;
        updateMoodUI();
      });
    });

    function updateMoodUI() {
      document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.toggle('bg-amber-200', btn.dataset.mood === currentDailyMood);
      });
      document.getElementById('selected-mood').textContent = currentDailyMood ? `Mood: ${currentDailyMood}` : '';
    }

    // Load today's habit
    function loadDailyHabit() {
      const targetDate = selectedHabitDate || new Date().toISOString().split('T')[0];
      const targetHabit = allData.find(d => d.type === 'habit' && d.date === targetDate && d.username === currentUser?.username);
      
      if (targetHabit) {
        currentDailyHabits = JSON.parse(targetHabit.habits || '[]');
        currentDailyMood = targetHabit.mood || '';
      } else {
        currentDailyHabits = [];
        currentDailyMood = '';
      }
      
      renderDailyHabits();
      updateMoodUI();
    }

    // Save Daily Habit
    document.getElementById('save-daily-habit-btn').addEventListener('click', async () => {
      if (isViewingMode && selectedHabitDate !== new Date().toISOString().split('T')[0]) {
        showToast('Hanya bisa menyimpan habit hari ini!', 'error');
        return;
      }

      const saveDate = selectedHabitDate || new Date().toISOString().split('T')[0];
      
      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const existingHabit = allData.find(d => d.type === 'habit' && d.date === saveDate && d.username === currentUser.username);

      if (existingHabit) {
        const updated = {
          ...existingHabit,
          habits: JSON.stringify(currentDailyHabits),
          mood: currentDailyMood
        };
        const result = await window.dataSdk.update(updated);
        if (result.isOk) {
          showToast('âœ“ Habit berhasil diperbarui!', 'success');
          renderMiniCalendar();
          scheduleAllNotifications();
        }
      } else {
        const result = await window.dataSdk.create({
          type: 'habit',
          username: currentUser.username,
          date: saveDate,
          habits: JSON.stringify(currentDailyHabits),
          mood: currentDailyMood,
          createdAt: new Date().toISOString()
        });
        if (result.isOk) {
          showToast('âœ“ Habit berhasil disimpan!', 'success');
          renderMiniCalendar();
          scheduleAllNotifications();
        }
      }
    });

    function scheduleAllNotifications() {
      if (!('Notification' in window)) {
        showToast('âš ï¸ Browser tidak mendukung notifikasi', 'error');
        return;
      }

      if (Notification.permission !== 'granted') {
        showToast('ğŸ“³ Aktifkan notifikasi terlebih dahulu di banner atas', 'error');
        return;
      }

      currentDailyHabits.forEach(habit => {
        if (habit.time) {
          scheduleNotification(habit.text, habit.time, selectedHabitDate);
        }
      });

      showToast('âœ“ Notifikasi dijadwalkan untuk habit hari ini', 'success');
    }

    let notificationTimeouts = [];

    function scheduleNotification(habitText, time, habitDate) {
      const [hours, minutes] = time.split(':');
      const scheduleTime = new Date(habitDate + 'T' + hours + ':' + minutes + ':00');
      const now = new Date();
      
      const diff = scheduleTime - now;
      
      if (diff > 0) {
        const timeoutId = setTimeout(() => {
          // Buat notifikasi
          new Notification('ğŸ¯ SNBT Fighter - Reminder Habit', {
            body: `Waktunya: ${habitText}`,
            icon: 'ğŸ¯',
            tag: 'snbt-habit-' + Date.now(),
            requireInteraction: true,
            silent: false
          });
          
          // Hapus dari array
          notificationTimeouts = notificationTimeouts.filter(t => t.id !== timeoutId);
        }, diff);

        // Simpan timeout ID untuk referensi
        notificationTimeouts.push({ id: timeoutId, habit: habitText });
      } else {
        // Jika waktu sudah lewat, kirim notifikasi segera
        new Notification('ğŸ¯ SNBT Fighter - Reminder Habit', {
          body: `Waktunya: ${habitText} (jadwal sudah lewat, jalankan sekarang!)`,
          icon: 'ğŸ¯',
          tag: 'snbt-habit-' + Date.now(),
          requireInteraction: true,
          silent: false
        });
      }
    }

    // Timer Functions
    function formatTime(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return { h, m, s };
    }

    function updateTimerDisplay() {
      const { h, m, s } = formatTime(timerSeconds);
      document.getElementById('timer-hours').textContent = String(h).padStart(2, '0');
      document.getElementById('timer-minutes').textContent = String(m).padStart(2, '0');
      document.getElementById('timer-seconds').textContent = String(s).padStart(2, '0');
    }

    // Set Countdown Timer
    document.getElementById('set-timer-btn').addEventListener('click', () => {
      const hours = parseInt(document.getElementById('timer-hours-input').value) || 0;
      const minutes = parseInt(document.getElementById('timer-minutes-input').value) || 0;
      const seconds = parseInt(document.getElementById('timer-seconds-input').value) || 0;

      countdownTotal = hours * 3600 + minutes * 60 + seconds;
      timerSeconds = countdownTotal;
      countdownMode = true;

      document.getElementById('timer-mode-label').textContent = 'Timer Hitung Mundur';
      updateTimerDisplay();
      showToast(`Timer diatur: ${hours}j ${minutes}m ${seconds}d`, 'success');
    });

    document.getElementById('timer-start').addEventListener('click', () => {
      if (!timerInterval) {
        timerInterval = setInterval(() => {
          if (countdownMode) {
            if (timerSeconds > 0) {
              timerSeconds--;
            } else {
              clearInterval(timerInterval);
              timerInterval = null;
              if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('â° Timer Habis!', {
                  body: 'Waktu belajar Anda sudah habis',
                  icon: 'â°'
                });
              }
              showToast('â° Timer habis!', 'success');
              countdownMode = false;
            }
          } else {
            timerSeconds++;
          }
          updateTimerDisplay();
        }, 1000);
      }
    });

    document.getElementById('timer-pause').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
    });

    document.getElementById('timer-reset').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
      if (countdownMode) {
        timerSeconds = countdownTotal;
      } else {
        timerSeconds = 0;
      }
      countdownMode = false;
      document.getElementById('timer-mode-label').textContent = 'Timer Hitung Maju';
      updateTimerDisplay();
    });

    document.getElementById('save-timer-btn').addEventListener('click', async () => {
      const subject = document.getElementById('timer-subject').value;
      const notes = document.getElementById('timer-notes').value;

      if (!subject) {
        showToast('Pilih mata pelajaran!', 'error');
        return;
      }

      if (timerSeconds === 0) {
        showToast('Timer belum berjalan!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'timer',
        username: currentUser.username,
        subject: subject,
        duration: timerSeconds,
        notes: notes,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Sesi belajar disimpan!', 'success');
        timerSeconds = 0;
        countdownMode = false;
        updateTimerDisplay();
        document.getElementById('timer-notes').value = '';
      }
    });

    // Latihan Functions
    function updateLatihanTimer() {
      const m = Math.floor(latihanSeconds / 60);
      const s = latihanSeconds % 60;
      document.getElementById('latihan-timer-min').textContent = String(m).padStart(2, '0');
      document.getElementById('latihan-timer-sec').textContent = String(s).padStart(2, '0');
    }

    document.getElementById('latihan-start').addEventListener('click', () => {
      if (!latihanTimerInterval) {
        latihanTimerInterval = setInterval(() => {
          latihanSeconds++;
          updateLatihanTimer();
        }, 1000);
      }
    });

    document.getElementById('latihan-pause').addEventListener('click', () => {
      clearInterval(latihanTimerInterval);
      latihanTimerInterval = null;
    });

    document.getElementById('latihan-reset').addEventListener('click', () => {
      clearInterval(latihanTimerInterval);
      latihanTimerInterval = null;
      latihanSeconds = 0;
      updateLatihanTimer();
    });

    document.getElementById('correct-plus').addEventListener('click', () => {
      correctCount++;
      document.getElementById('latihan-correct').textContent = correctCount;
    });

    document.getElementById('correct-minus').addEventListener('click', () => {
      if (correctCount > 0) correctCount--;
      document.getElementById('latihan-correct').textContent = correctCount;
    });

    document.getElementById('wrong-plus').addEventListener('click', () => {
      wrongCount++;
      document.getElementById('latihan-wrong').textContent = wrongCount;
    });

    document.getElementById('wrong-minus').addEventListener('click', () => {
      if (wrongCount > 0) wrongCount--;
      document.getElementById('latihan-wrong').textContent = wrongCount;
    });

    document.getElementById('save-latihan-btn').addEventListener('click', async () => {
      const subject = document.getElementById('latihan-subject').value;
      const notes = document.getElementById('latihan-notes').value;

      if (!subject) {
        showToast('Pilih mata pelajaran!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'latihan',
        username: currentUser.username,
        subject: subject,
        duration: latihanSeconds,
        correct: correctCount,
        wrong: wrongCount,
        notes: notes,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Latihan disimpan!', 'success');
        latihanSeconds = 0;
        correctCount = 0;
        wrongCount = 0;
        updateLatihanTimer();
        document.getElementById('latihan-correct').textContent = '0';
        document.getElementById('latihan-wrong').textContent = '0';
        document.getElementById('latihan-notes').value = '';
      }
    });

    // Game Kata
    document.getElementById('add-kata-btn').addEventListener('click', () => {
      const baku = document.getElementById('kata-baku-input').value.trim();
      const tidakBaku = document.getElementById('kata-tidak-baku-input').value.trim();

      if (baku && tidakBaku) {
        kataList.push({ baku, tidakBaku });
        renderKataList();
        document.getElementById('kata-baku-input').value = '';
        document.getElementById('kata-tidak-baku-input').value = '';
      }
    });

    function renderKataList() {
      const container = document.getElementById('kata-list');
      if (kataList.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm">Belum ada kata</p>';
        return;
      }

      container.innerHTML = kataList.map((k, i) => `
        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2 text-sm">
          <span class="text-green-600 font-medium">${k.baku}</span>
          <span class="text-gray-400">vs</span>
          <span class="text-red-500">${k.tidakBaku}</span>
          <button onclick="deleteKata(${i})" class="text-red-400 hover:text-red-600 ml-2">Ã—</button>
        </div>
      `).join('');
    }

    window.deleteKata = function(index) {
      kataList.splice(index, 1);
      renderKataList();
    };

    document.getElementById('play-kata-btn').addEventListener('click', () => {
      if (kataList.length < 2) {
        showToast('Tambahkan minimal 2 kata!', 'error');
        return;
      }
      document.getElementById('kata-game-area').classList.remove('hidden');
      kataGameScore = { correct: 0, wrong: 0 };
      nextKataQuestion();
    });

    function nextKataQuestion() {
      const random = kataList[Math.floor(Math.random() * kataList.length)];
      const options = Math.random() > 0.5 ? [random.baku, random.tidakBaku] : [random.tidakBaku, random.baku];
      
      document.getElementById('kata-question').textContent = 'Pilih kata yang BAKU:';
      document.getElementById('kata-options').innerHTML = options.map(opt => `
        <button onclick="checkKata('${opt}', '${random.baku}')" class="bg-white hover:bg-amber-100 border-2 border-gray-200 px-4 py-2 rounded-lg font-medium transition">${opt}</button>
      `).join('');
    }

    window.checkKata = function(selected, correct) {
      if (selected === correct) {
        kataGameScore.correct++;
        showToast('Benar! ğŸ‰', 'success');
      } else {
        kataGameScore.wrong++;
        showToast(`Salah! Jawaban: ${correct}`, 'error');
      }
      document.getElementById('kata-score-correct').textContent = kataGameScore.correct;
      document.getElementById('kata-score-wrong').textContent = kataGameScore.wrong;
      setTimeout(nextKataQuestion, 1000);
    };

    // Vocabulary Game
    document.getElementById('add-vocab-btn').addEventListener('click', () => {
      const eng = document.getElementById('vocab-eng-input').value.trim();
      const ind = document.getElementById('vocab-ind-input').value.trim();

      if (eng && ind) {
        vocabList.push({ eng, ind });
        renderVocabList();
        document.getElementById('vocab-eng-input').value = '';
        document.getElementById('vocab-ind-input').value = '';
      }
    });

    function renderVocabList() {
      const container = document.getElementById('vocab-list');
      if (vocabList.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm">Belum ada kosakata</p>';
        return;
      }

      container.innerHTML = vocabList.map((v, i) => `
        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2 text-sm">
          <span class="text-blue-600 font-medium">${v.eng}</span>
          <span class="text-gray-400">=</span>
          <span class="text-green-600">${v.ind}</span>
          <button onclick="deleteVocab(${i})" class="text-red-400 hover:text-red-600 ml-2">Ã—</button>
        </div>
      `).join('');
    }

    window.deleteVocab = function(index) {
      vocabList.splice(index, 1);
      renderVocabList();
    };

    document.getElementById('play-vocab-btn').addEventListener('click', () => {
      if (vocabList.length < 3) {
        showToast('Tambahkan minimal 3 kosakata!', 'error');
        return;
      }
      document.getElementById('vocab-game-area').classList.remove('hidden');
      vocabGameScore = { correct: 0, wrong: 0 };
      nextVocabQuestion();
    });

    function nextVocabQuestion() {
      const correct = vocabList[Math.floor(Math.random() * vocabList.length)];
      const wrongOptions = vocabList.filter(v => v !== correct).sort(() => Math.random() - 0.5).slice(0, 2);
      const options = [...wrongOptions.map(w => w.ind), correct.ind].sort(() => Math.random() - 0.5);

      document.getElementById('vocab-question').textContent = correct.eng;
      document.getElementById('vocab-options').innerHTML = options.map(opt => `
        <button onclick="checkVocab('${opt}', '${correct.ind}')" class="bg-white hover:bg-blue-100 border-2 border-gray-200 px-4 py-2 rounded-lg font-medium transition">${opt}</button>
      `).join('');
    }

    window.checkVocab = function(selected, correct) {
      if (selected === correct) {
        vocabGameScore.correct++;
        showToast('Correct! ğŸ‰', 'success');
      } else {
        vocabGameScore.wrong++;
        showToast(`Wrong! Answer: ${correct}`, 'error');
      }
      document.getElementById('vocab-score-correct').textContent = vocabGameScore.correct;
      document.getElementById('vocab-score-wrong').textContent = vocabGameScore.wrong;
      setTimeout(nextVocabQuestion, 1000);
    };

    // Math Games
    document.getElementById('start-hitung-btn').addEventListener('click', () => {
      const level = document.getElementById('hitung-level').value;
      document.getElementById('hitung-game-area').classList.remove('hidden');
      document.getElementById('hitung-current-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
      hitungScore = { correct: 0, wrong: 0 };
      hitungTimer = 60;
      hitungGameActive = true;
      document.getElementById('hitung-timer').textContent = hitungTimer;
      document.getElementById('hitung-correct').textContent = '0';
      document.getElementById('hitung-wrong').textContent = '0';
      generateHitungQuestion(level);
      
      hitungInterval = setInterval(() => {
        hitungTimer--;
        document.getElementById('hitung-timer').textContent = hitungTimer;
        if (hitungTimer <= 0) {
          clearInterval(hitungInterval);
          hitungGameActive = false;
          showToast(`Waktu habis! Benar: ${hitungScore.correct}, Salah: ${hitungScore.wrong}`, 'success');
        }
      }, 1000);
    });

    function generateHitungQuestion(level) {
      let a, b, op, answer;
      const ops = level === 'mudah' ? ['+', '-', 'Ã—'] : level === 'sedang' ? ['+', '-', 'Ã—', 'Ã·'] : ['+', '-', 'Ã—', 'Ã·', '^', 'âˆš'];
      op = ops[Math.floor(Math.random() * ops.length)];

      switch(op) {
        case '+':
          a = Math.floor(Math.random() * 50) + 1;
          b = Math.floor(Math.random() * 50) + 1;
          answer = a + b;
          break;
        case '-':
          a = Math.floor(Math.random() * 50) + 20;
          b = Math.floor(Math.random() * 20) + 1;
          answer = a - b;
          break;
        case 'Ã—':
          a = Math.floor(Math.random() * 12) + 1;
          b = Math.floor(Math.random() * 12) + 1;
          answer = a * b;
          break;
        case 'Ã·':
          b = Math.floor(Math.random() * 10) + 1;
          answer = Math.floor(Math.random() * 10) + 1;
          a = b * answer;
          break;
        case '^':
          a = Math.floor(Math.random() * 10) + 2;
          b = 2;
          answer = Math.pow(a, b);
          break;
        case 'âˆš':
          answer = Math.floor(Math.random() * 10) + 2;
          a = answer * answer;
          b = null;
          break;
      }

      const questionText = b !== null ? `${a} ${op} ${b} = ?` : `âˆš${a} = ?`;
      document.getElementById('hitung-question').textContent = questionText;
      document.getElementById('hitung-answer').value = '';
      document.getElementById('hitung-answer').dataset.answer = answer;
    }

    document.getElementById('hitung-submit').addEventListener('click', () => {
      if (!hitungGameActive) return;
      
      const userAnswer = parseInt(document.getElementById('hitung-answer').value);
      const correctAnswer = parseInt(document.getElementById('hitung-answer').dataset.answer);

      if (userAnswer === correctAnswer) {
        hitungScore.correct++;
        document.getElementById('hitung-correct').textContent = hitungScore.correct;
      } else {
        hitungScore.wrong++;
        document.getElementById('hitung-wrong').textContent = hitungScore.wrong;
      }

      generateHitungQuestion(document.getElementById('hitung-level').value);
    });

    document.getElementById('hitung-answer').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('hitung-submit').click();
    });

    // Memory Game
    document.getElementById('start-memory-btn').addEventListener('click', () => {
      const level = document.getElementById('memory-level').value;
      document.getElementById('memory-game-area').classList.remove('hidden');
      document.getElementById('memory-current-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
      initMemoryGame(level);
    });

    function initMemoryGame(level) {
      const pairs = level === 'mudah' ? 4 : level === 'sedang' ? 6 : 8;
      memoryCards = [];
      memoryFlipped = [];
      memoryMatched = [];
      memoryMoves = 0;

      const operations = [];
      for (let i = 0; i < pairs; i++) {
        let a, b, op, result;
        const opTypes = ['+', '-', 'Ã—', 'Ã·'];
        op = opTypes[Math.floor(Math.random() * opTypes.length)];

        switch(op) {
          case '+':
            a = Math.floor(Math.random() * 10) + 1;
            b = Math.floor(Math.random() * 10) + 1;
            result = a + b;
            break;
          case '-':
            a = Math.floor(Math.random() * 10) + 10;
            b = Math.floor(Math.random() * 10) + 1;
            result = a - b;
            break;
          case 'Ã—':
            a = Math.floor(Math.random() * 5) + 1;
            b = Math.floor(Math.random() * 5) + 1;
            result = a * b;
            break;
          case 'Ã·':
            b = Math.floor(Math.random() * 5) + 1;
            result = Math.floor(Math.random() * 5) + 1;
            a = b * result;
            break;
        }

        operations.push({ text: `${a} ${op} ${b}`, pairId: i, isOp: true });
        operations.push({ text: `${result}`, pairId: i, isOp: false });
      }

      memoryCards = operations.sort(() => Math.random() - 0.5);
      renderMemoryGrid(pairs);
    }

    function renderMemoryGrid(pairs) {
      const grid = document.getElementById('memory-grid');
      const cols = pairs <= 4 ? 4 : pairs <= 6 ? 4 : 4;
      grid.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;

      grid.innerHTML = memoryCards.map((card, i) => `
        <div class="flip-card w-20 h-20 cursor-pointer" data-index="${i}" onclick="flipCard(${i})">
          <div class="flip-card-inner relative w-full h-full">
            <div class="flip-card-front absolute w-full h-full bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center text-white text-2xl font-bold">?</div>
            <div class="flip-card-back absolute w-full h-full bg-white rounded-xl flex items-center justify-center text-gray-800 font-bold text-sm border-2 border-purple-300 p-1 text-center">${card.text}</div>
          </div>
        </div>
      `).join('');

      document.getElementById('memory-moves').textContent = '0';
      document.getElementById('memory-matches').textContent = '0';
    }

    window.flipCard = function(index) {
      if (memoryFlipped.length >= 2 || memoryFlipped.includes(index) || memoryMatched.includes(index)) return;

      const card = document.querySelectorAll('.flip-card')[index];
      card.classList.add('flipped');
      memoryFlipped.push(index);

      if (memoryFlipped.length === 2) {
        memoryMoves++;
        document.getElementById('memory-moves').textContent = memoryMoves;

        const [first, second] = memoryFlipped;
        if (memoryCards[first].pairId === memoryCards[second].pairId) {
          memoryMatched.push(first, second);
          document.getElementById('memory-matches').textContent = memoryMatched.length / 2;
          memoryFlipped = [];

          if (memoryMatched.length === memoryCards.length) {
            showToast(`Selamat! Selesai dalam ${memoryMoves} langkah!`, 'success');
          }
        } else {
          setTimeout(() => {
            document.querySelectorAll('.flip-card')[first].classList.remove('flipped');
            document.querySelectorAll('.flip-card')[second].classList.remove('flipped');
            memoryFlipped = [];
          }, 1000);
        }
      }
    };

    // Save Math Game
    document.getElementById('save-math-btn').addEventListener('click', async () => {
      const hitungActive = !document.getElementById('hitung-game-area').classList.contains('hidden');
      const memoryActive = !document.getElementById('memory-game-area').classList.contains('hidden');

      if (!hitungActive && !memoryActive) {
        showToast('Mainkan game terlebih dahulu!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const gameType = hitungActive ? 'hitung_cepat' : 'memory';
      const score = hitungActive ? hitungScore.correct : memoryMatched.length / 2;
      const level = hitungActive ? document.getElementById('hitung-level').value : document.getElementById('memory-level').value;

      const result = await window.dataSdk.create({
        type: 'game',
        username: currentUser.username,
        gameType: gameType,
        level: level,
        score: score,
        correct: hitungActive ? hitungScore.correct : memoryMatched.length / 2,
        wrong: hitungActive ? hitungScore.wrong : memoryMoves - (memoryMatched.length / 2),
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Skor game disimpan!', 'success');
      }
    });

    // Statistics & History
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => {
          b.classList.remove('bg-gray-800', 'text-white');
          b.classList.add('bg-gray-200', 'text-gray-700');
        });
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-gray-800', 'text-white');
        currentFilter = btn.dataset.filter;
        renderHistory();
      });
    });

    function updateStats() {
      if (!currentUser) return;

      const timerSessions = allData.filter(d => d.type === 'timer' && d.username === currentUser.username);
      const latihanSessions = allData.filter(d => d.type === 'latihan' && d.username === currentUser.username);
      const gameSessions = allData.filter(d => d.type === 'game' && d.username === currentUser.username);
      const habitSessions = allData.filter(d => d.type === 'habit' && d.username === currentUser.username);

      const totalStudySeconds = timerSessions.reduce((sum, s) => sum + (s.duration || 0), 0);
      const totalHabitsDone = habitSessions.reduce((sum, h) => {
        const habits = JSON.parse(h.habits || '[]');
        return sum + habits.filter(hh => hh.done).length;
      }, 0);

      document.getElementById('stat-study-hours').textContent = (totalStudySeconds / 3600).toFixed(1);
      document.getElementById('stat-latihan').textContent = latihanSessions.length;
      document.getElementById('stat-games').textContent = gameSessions.length;
      document.getElementById('stat-habits').textContent = totalHabitsDone;

      renderHistory();
    }

    function renderHistory() {
      if (!currentUser) return;

      const container = document.getElementById('history-list');
      let filtered = allData.filter(d => d.username === currentUser.username && d.type !== 'user');

      if (currentFilter !== 'all') {
        filtered = filtered.filter(d => d.type === currentFilter);
      }

      filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">Belum ada riwayat</p>';
        return;
      }

      container.innerHTML = filtered.map(item => {
        const date = new Date(item.createdAt).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        let content = '';
        let icon = '';
        let bgColor = '';

        switch(item.type) {
          case 'timer':
            icon = 'â±ï¸';
            bgColor = 'bg-blue-50 border-blue-200';
            const { h, m, s } = formatTime(item.duration);
            content = `<strong>${item.subject}</strong><br>Durasi: ${h}j ${m}m ${s}d${item.notes ? `<br><small class="text-gray-500">${item.notes.substring(0, 50)}...</small>` : ''}`;
            break;
          case 'latihan':
            icon = 'ğŸ“';
            bgColor = 'bg-green-50 border-green-200';
            content = `<strong>${item.subject}</strong><br>âœ“ ${item.correct} Benar | âœ— ${item.wrong} Salah`;
            break;
          case 'game':
            icon = 'ğŸ®';
            bgColor = 'bg-amber-50 border-amber-200';
            content = `<strong>${item.gameType === 'hitung_cepat' ? 'Hitung Cepat' : 'Memory Match'}</strong><br>Level: ${item.level} | Skor: ${item.score}`;
            break;
          case 'habit':
            icon = 'ğŸ“‹';
            bgColor = 'bg-purple-50 border-purple-200';
            const habits = JSON.parse(item.habits || '[]');
            const done = habits.filter(h => h.done).length;
            content = `<strong>Habit ${item.date}</strong><br>${done}/${habits.length} selesai ${item.mood ? `| Mood: ${item.mood}` : ''}`;
            break;
        }

        return `
          <div class="${bgColor} border rounded-xl p-4">
            <div class="flex items-start gap-3">
              <span class="text-2xl">${icon}</span>
              <div class="flex-1">
                <div class="text-sm text-gray-800">${content}</div>
                <div class="text-xs text-gray-400 mt-1">${date}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function resetTimers() {
      clearInterval(timerInterval);
      clearInterval(latihanTimerInterval);
      clearInterval(hitungInterval);
      timerInterval = null;
      latihanTimerInterval = null;
      hitungInterval = null;
      timerSeconds = 0;
      latihanSeconds = 0;
      countdownMode = false;
    }

    // Initial render
    renderKataList();
    renderVocabList();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ca93866f63bfd74',t:'MTc3MDUzMzcxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
ctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SNBT Fighter Journey</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
    }
    .card-glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    .btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
    }
    .tab-active {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
      color: white;
    }
    .progress-ring {
      transform: rotate(-90deg);
    }
    .habit-item {
      transition: all 0.3s ease;
    }
    .habit-item:hover {
      transform: translateX(5px);
    }
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.8); }
    }
    .countdown-glow {
      animation: pulse-glow 2s infinite;
    }
    .toast {
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .calendar-mini {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 4px;
    }
    .calendar-mini-day {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg">
  <div id="app" class="h-full overflow-auto"><!-- Toast Container -->
   <div id="toast-container" class="fixed top-4 right-4 z-50"></div><!-- Login Screen -->
   <div id="login-screen" class="min-h-full flex items-center justify-center p-4">
    <div class="card-glass rounded-3xl p-8 w-full max-w-md shadow-2xl">
     <div class="text-center mb-8">
      <div class="text-6xl mb-4">
       ğŸ¯
      </div>
      <h1 id="app-title" class="text-3xl font-bold text-gray-800 mb-2">SNBT Fighter Journey</h1>
      <p class="text-gray-600">Perjalanan Menuju Sukses SNBT 2026</p>
     </div><!-- Login Form -->
     <div id="login-form">
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Masukkan PIN</label> <input type="password" id="pin-input" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div><button id="login-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> Masuk </button>
      <div id="login-error" class="text-red-500 text-center text-sm mb-4 hidden"></div>
      <div class="border-t pt-4 mt-4">
       <p class="text-gray-600 text-sm text-center mb-3">ğŸ“± Dapatkan PIN dengan menghubungi kami:</p><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="block text-center text-amber-600 font-medium hover:text-amber-700 underline"> lynk.id/suksesbarengjalurlangit </a>
      </div>
      <div class="flex gap-2 mt-6"><button id="show-pins-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-xl transition text-sm"> ğŸ‘ï¸ Lihat PIN </button> <button id="show-admin-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-xl transition text-sm"> ğŸ” Admin </button>
      </div>
     </div><!-- View Pins -->
     <div id="view-pins" class="hidden">
      <h3 class="text-lg font-bold text-gray-800 mb-4">PIN Terdaftar</h3>
      <div id="pins-list" class="max-h-60 overflow-y-auto space-y-2 mb-4"></div><button id="back-from-pins" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> â† Kembali </button>
     </div><!-- Admin Panel -->
     <div id="admin-panel" class="hidden">
      <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ” Kelola PIN</h3>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Kode Admin</label> <input type="password" id="admin-code" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="Masukkan kode admin">
      </div>
      <div id="pin-creation" class="hidden">
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Username</label> <input type="text" id="new-username" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="Nama pengguna">
       </div>
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Baru (4 digit)</label> <input type="text" id="new-pin" maxlength="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
       </div><button id="create-pin-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-2"> Buat PIN </button>
      </div><button id="verify-admin-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-2"> Verifikasi </button> <button id="back-from-admin" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> â† Kembali </button>
     </div>
    </div>
   </div><!-- Main Dashboard -->
   <div id="main-dashboard" class="hidden min-h-full"><!-- Header -->
    <header class="bg-white/95 backdrop-blur-lg shadow-lg sticky top-0 z-40">
     <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-3"><span class="text-3xl">ğŸ¯</span>
       <div>
        <h1 class="font-bold text-gray-800">SNBT Fighter</h1>
        <p id="user-welcome" class="text-xs text-gray-500"></p>
       </div>
      </div>
      <div class="flex gap-2"><button id="change-pin-btn" class="bg-amber-100 hover:bg-amber-200 text-amber-700 px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ”‘ Ganti PIN </button> <button id="logout-btn" class="bg-red-100 hover:bg-red-200 text-red-600 px-3 py-2 rounded-lg text-sm font-medium transition"> Keluar </button>
      </div>
     </div>
    </header><!-- Change PIN Modal -->
    <div id="change-pin-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
     <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
      <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ”‘ Ganti PIN</h3>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Lama</label> <input type="password" id="old-pin-input" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div>
      <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">PIN Baru</label> <input type="password" id="new-pin-change" maxlength="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none transition" placeholder="****">
      </div>
      <div class="flex gap-2"><button id="cancel-change-pin" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-xl transition"> Batal </button> <button id="save-change-pin" class="flex-1 btn-primary text-white font-medium py-2 rounded-xl"> Simpan </button>
      </div>
     </div>
    </div><!-- Notification Permission Request -->
    <div id="notification-banner" class="hidden bg-blue-100 border-l-4 border-blue-500 p-4 m-4 rounded">
     <div class="flex justify-between items-center">
      <div class="text-sm text-blue-700"><strong>ğŸ”” Aktifkan Notifikasi</strong> untuk mendapat reminder habit Anda
      </div><button id="enable-notifications-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm font-medium"> Aktifkan </button>
     </div>
    </div><!-- Tabs Navigation -->
    <nav class="bg-white/90 backdrop-blur-lg border-b sticky top-16 z-30">
     <div class="max-w-7xl mx-auto px-2">
      <div class="flex overflow-x-auto no-scrollbar"><button class="tab-btn tab-active flex-shrink-0 px-4 py-3 font-medium text-sm rounded-t-lg transition" data-tab="dashboard"> ğŸ“Š Dashboard </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="timer"> ï¿½ï¿½ï¿½ï¸ Timer </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="latihan"> ğŸ“ Latihan </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="game-kata"> ğŸ”¤ Game Kata </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="game-math"> ğŸ§® Game Math </button> <button class="tab-btn flex-shrink-0 px-4 py-3 font-medium text-sm text-gray-600 hover:bg-gray-100 rounded-t-lg transition" data-tab="statistik"> ğŸ“ˆ Statistik </button>
      </div>
     </div>
    </nav><!-- Tab Contents -->
    <main class="max-w-7xl mx-auto p-4"><!-- Dashboard Tab -->
     <div id="tab-dashboard" class="tab-content pb-16"><!-- Countdown Section -->
      <div class="card-glass rounded-2xl p-6 mb-6 shadow-xl">
       <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">â³ Countdown Menuju SNBT 2026</h2>
       <div class="flex flex-wrap justify-center gap-4 mb-6">
        <div class="bg-gradient-to-br from-amber-400 to-amber-600 text-white rounded-2xl p-4 min-w-24 text-center countdown-glow">
         <div id="countdown-days" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Hari
         </div>
        </div>
        <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-hours" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Jam
         </div>
        </div>
        <div class="bg-gradient-to-br from-green-500 to-green-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-minutes" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Menit
         </div>
        </div>
        <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-2xl p-4 min-w-24 text-center">
         <div id="countdown-seconds" class="text-4xl font-bold">
          0
         </div>
         <div class="text-sm opacity-90">
          Detik
         </div>
        </div>
       </div><!-- Progress Bar -->
       <div class="mb-4">
        <div class="flex justify-between text-sm text-gray-600 mb-2"><span>Progress Perjalanan</span> <span id="progress-percent">0%</span>
        </div>
        <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
         <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 to-amber-600 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>2 Feb 2026</span> <span>21 Apr 2026</span>
        </div>
       </div>
      </div><!-- Habits & Mood Section -->
      <div class="card-glass rounded-2xl p-6 shadow-xl mb-6">
       <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“‹ Habit Harian</h3><!-- Date Selection -->
       <div class="mb-4 p-3 bg-blue-50 rounded-lg border-2 border-blue-200"><label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“… Pilih Tanggal Habit</label>
        <div class="flex gap-2 items-center"><input type="date" id="habit-date-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-blue-300 focus:border-amber-500 focus:outline-none text-sm"> <button id="view-habit-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">ğŸ‘ï¸ Lihat</button> <button id="today-habit-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">ğŸ“† Hari Ini</button>
        </div>
        <p id="habit-date-display" class="text-xs text-gray-500 mt-2"></p>
       </div><!-- Add Daily Habit -->
       <div class="flex gap-2 mb-4 flex-wrap"><input type="text" id="new-habit-input" class="flex-1 min-w-40 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Tambah habit..."> <input type="time" id="habit-time-input" class="px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm"> <button id="add-daily-habit-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
       </div><!-- Daily Habits List -->
       <div id="daily-habits-list" class="max-h-40 overflow-y-auto space-y-2 mb-4"></div><!-- Mood Selection -->
       <div class="border-t pt-4 mb-4">
        <h4 class="font-medium text-gray-700 mb-2">ğŸ­ Mood Hari Ini</h4>
        <div class="flex gap-2 flex-wrap"><button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜Š">ğŸ˜Š</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜">ğŸ˜</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜”">ğŸ˜”</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ˜¤">ğŸ˜¤</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ”¥">ğŸ”¥</button> <button class="mood-btn text-2xl p-2 rounded-lg hover:bg-gray-100 transition" data-mood="ğŸ’ª">ğŸ’ª</button>
        </div>
        <p id="selected-mood" class="text-sm text-gray-500 mt-2"></p>
       </div><button id="save-daily-habit-btn" class="w-full btn-primary text-white font-medium py-2 rounded-xl"> ğŸ’¾ Simpan Habit &amp; Mood </button>
      </div><!-- Mini Calendar -->
      <div class="card-glass rounded-2xl p-6 shadow-xl mb-6">
       <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“… Kalender Perjalanan SNBT (Hari 1-80)</h3>
       <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">2 Februari - 21 April 2026</span>
        <div class="text-sm text-gray-500" id="calendar-progress">
         Hari 1 - 80
        </div>
       </div>
       <div class="calendar-mini" id="mini-calendar"></div>
      </div><!-- Footer -->
      <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-6 text-center">
       <p class="text-sm text-gray-700 mb-3">ğŸ“± Follow kami di Instagram</p><a href="https://www.instagram.com/ferdiansyah_ypf/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 mb-4 hover:opacity-80 transition">
        <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.322a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z" />
        </svg><span class="font-bold text-amber-600">@ferdiansyah_ypf</span> </a>
       <p class="text-xs text-gray-600 mb-3">Temukan produk bermanfaat lainnya:</p>
       <div class="flex gap-2 justify-center"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ”— Kunjungi Web </a> <button id="copy-url-dashboard" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium transition"> ğŸ“‹ Copy URL </button>
       </div>
      </div>
     </div><!-- Timer Tab -->
     <div id="tab-timer" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">â±ï¸ Timer Belajar</h2><!-- Subject Selection -->
       <div class="mb-6"><label class="block text-gray-700 font-medium mb-2">Mata Pelajaran SNBT</label> <select id="timer-subject" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none"> <option value="">Pilih Mata Pelajaran</option> <option value="Penalaran Umum">Penalaran Umum</option> <option value="Pengetahuan Kuantitatif">Pengetahuan Kuantitatif</option> <option value="Pengetahuan dan Pemahaman Umum">Pengetahuan dan Pemahaman Umum</option> <option value="Kemampuan Memahami Bacaan dan Menulis">Kemampuan Memahami Bacaan dan Menulis</option> <option value="Literasi Bahasa Indonesia">Literasi Bahasa Indonesia</option> <option value="Literasi Bahasa Inggris">Literasi Bahasa Inggris</option> <option value="Penalaran Matematika">Penalaran Matematika</option> </select>
       </div><!-- Countdown Timer Setup -->
       <div class="bg-blue-50 rounded-2xl p-4 mb-6">
        <h3 class="font-bold text-gray-800 mb-3">â³ Timer Hitung Mundur (Opsional)</h3>
        <div class="grid grid-cols-3 gap-3 mb-3">
         <div><label class="block text-sm text-gray-600 mb-1">Jam</label> <input type="number" id="timer-hours-input" min="0" max="23" value="0" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
         <div><label class="block text-sm text-gray-600 mb-1">Menit</label> <input type="number" id="timer-minutes-input" min="0" max="59" value="30" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
         <div><label class="block text-sm text-gray-600 mb-1">Detik</label> <input type="number" id="timer-seconds-input" min="0" max="59" value="0" class="w-full px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-center">
         </div>
        </div><button id="set-timer-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 rounded-lg"> â±ï¸ Gunakan Timer Hitung Mundur </button>
       </div><!-- Timer Display (Regular) -->
       <div class="text-center mb-6">
        <div class="text-7xl font-bold text-gray-800 font-mono mb-4"><span id="timer-hours">00</span>:<span id="timer-minutes">00</span>:<span id="timer-seconds">00</span>
        </div>
        <p id="timer-mode-label" class="text-sm text-gray-500 mb-3">Timer Hitung Maju</p>
        <div class="flex justify-center gap-3"><button id="timer-start" class="bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-3 rounded-xl transition"> â–¶ Mulai </button> <button id="timer-pause" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-6 py-3 rounded-xl transition"> â¸ Jeda </button> <button id="timer-reset" class="bg-red-500 hover:bg-red-600 text-white font-bold px-6 py-3 rounded-xl transition"> ğŸ”„ Reset </button>
        </div>
       </div><!-- Notes -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">ğŸ“ Catatan &amp; Refleksi</label> <textarea id="timer-notes" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none h-32 resize-none" placeholder="Tulis catatan atau refleksi saat belajar..."></textarea>
       </div><button id="save-timer-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Sesi Belajar </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-timer" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Latihan Tab -->
     <div id="tab-latihan" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“ Latihan Soal SNBT</h2><!-- Subject Selection -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">Mata Pelajaran</label> <select id="latihan-subject" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none"> <option value="">Pilih Mata Pelajaran</option> <option value="Penalaran Umum">Penalaran Umum</option> <option value="Pengetahuan Kuantitatif">Pengetahuan Kuantitatif</option> <option value="Pengetahuan dan Pemahaman Umum">Pengetahuan dan Pemahaman Umum</option> <option value="Kemampuan Memahami Bacaan dan Menulis">Kemampuan Memahami Bacaan dan Menulis</option> <option value="Literasi Bahasa Indonesia">Literasi Bahasa Indonesia</option> <option value="Literasi Bahasa Inggris">Literasi Bahasa Inggris</option> <option value="Penalaran Matematika">Penalaran Matematika</option> </select>
       </div><!-- Timer -->
       <div class="bg-gray-100 rounded-xl p-4 mb-4">
        <div class="text-center mb-3"><span class="text-3xl font-bold font-mono text-gray-800"> <span id="latihan-timer-min">00</span>:<span id="latihan-timer-sec">00</span> </span>
        </div>
        <div class="flex justify-center gap-2"><button id="latihan-start" class="bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">â–¶ Mulai</button> <button id="latihan-pause" class="bg-amber-500 hover:bg-amber-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">â¸ Jeda</button> <button id="latihan-reset" class="bg-red-500 hover:bg-red-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition">ğŸ”„ Reset</button>
        </div>
       </div><!-- Score -->
       <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="bg-green-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-green-600" id="latihan-correct">
          0
         </div>
         <div class="text-sm text-green-700">
          âœ“ Benar
         </div>
         <div class="flex justify-center gap-2 mt-2"><button id="correct-minus" class="bg-green-200 hover:bg-green-300 text-green-700 w-8 h-8 rounded-lg font-bold">-</button> <button id="correct-plus" class="bg-green-200 hover:bg-green-300 text-green-700 w-8 h-8 rounded-lg font-bold">+</button>
         </div>
        </div>
        <div class="bg-red-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-red-600" id="latihan-wrong">
          0
         </div>
         <div class="text-sm text-red-700">
          âœ— Salah
         </div>
         <div class="flex justify-center gap-2 mt-2"><button id="wrong-minus" class="bg-red-200 hover:bg-red-300 text-red-700 w-8 h-8 rounded-lg font-bold">-</button> <button id="wrong-plus" class="bg-red-200 hover:bg-red-300 text-red-700 w-8 h-8 rounded-lg font-bold">+</button>
         </div>
        </div>
       </div><!-- Notes -->
       <div class="mb-4"><label class="block text-gray-700 font-medium mb-2">ğŸ“ Catatan</label> <textarea id="latihan-notes" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-amber-500 focus:outline-none h-24 resize-none" placeholder="Catatan tentang latihan soal..."></textarea>
       </div><button id="save-latihan-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Latihan </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-latihan" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Game Kata Tab -->
     <div id="tab-game-kata" class="tab-content hidden pb-16">
      <div class="grid md:grid-cols-2 gap-6"><!-- Kata Baku -->
       <div class="card-glass rounded-2xl p-6 shadow-xl">
        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“– Game Kata Baku</h3>
        <p class="text-sm text-gray-600 mb-4">Tambahkan kata baku dan tidak baku untuk belajar!</p>
        <div class="flex gap-2 mb-4"><input type="text" id="kata-baku-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Kata baku"> <input type="text" id="kata-tidak-baku-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Tidak baku"> <button id="add-kata-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
        </div>
        <div id="kata-list" class="max-h-48 overflow-y-auto space-y-2 mb-4"></div><button id="play-kata-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition"> ğŸ® Main Game Kata Baku </button> <!-- Game Area -->
        <div id="kata-game-area" class="hidden mt-4 bg-gray-100 rounded-xl p-4">
         <div class="text-center mb-4">
          <p class="text-sm text-gray-600 mb-2">Pilih kata yang BAKU:</p>
          <div id="kata-question" class="text-xl font-bold text-gray-800 mb-4"></div>
          <div id="kata-options" class="flex gap-3 justify-center flex-wrap"></div>
         </div>
         <div class="flex justify-between text-sm"><span class="text-green-600">âœ“ Benar: <span id="kata-score-correct">0</span></span> <span class="text-red-600">âœ— Salah: <span id="kata-score-wrong">0</span></span>
         </div>
        </div>
       </div><!-- Vocabulary English -->
       <div class="card-glass rounded-2xl p-6 shadow-xl">
        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ”¤ Vocabulary English</h3>
        <p class="text-sm text-gray-600 mb-4">Tambahkan kosakata bahasa Inggris!</p>
        <div class="flex gap-2 mb-4"><input type="text" id="vocab-eng-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="English"> <input type="text" id="vocab-ind-input" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 focus:border-amber-500 focus:outline-none text-sm" placeholder="Indonesia"> <button id="add-vocab-btn" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">+</button>
        </div>
        <div id="vocab-list" class="max-h-48 overflow-y-auto space-y-2 mb-4"></div><button id="play-vocab-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl transition"> ğŸ® Main Vocabulary Game </button> <!-- Game Area -->
        <div id="vocab-game-area" class="hidden mt-4 bg-gray-100 rounded-xl p-4">
         <div class="text-center mb-4">
          <p class="text-sm text-gray-600 mb-2">Apa arti kata ini?</p>
          <div id="vocab-question" class="text-xl font-bold text-gray-800 mb-4"></div>
          <div id="vocab-options" class="flex gap-3 justify-center flex-wrap"></div>
         </div>
         <div class="flex justify-between text-sm"><span class="text-green-600">âœ“ Benar: <span id="vocab-score-correct">0</span></span> <span class="text-red-600">âœ— Salah: <span id="vocab-score-wrong">0</span></span>
         </div>
        </div>
       </div>
      </div><!-- Footer -->
      <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm mt-6">
       <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
       <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
       <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
       <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-kata" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
       </div>
      </div>
     </div><!-- Game Math Tab -->
     <div id="tab-game-math" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl max-w-4xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ§® Game Matematika</h2><!-- Game Selection -->
       <div class="grid md:grid-cols-2 gap-6 mb-6"><!-- Hitung Cepat -->
        <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-2xl p-6">
         <h3 class="text-xl font-bold mb-2">âš¡ Hitung Cepat</h3>
         <p class="text-sm opacity-90 mb-4">Jawab soal matematika secepat mungkin!</p>
         <div class="mb-4"><label class="block text-sm font-medium mb-2">Level:</label> <select id="hitung-level" class="w-full px-3 py-2 rounded-lg text-gray-800"> <option value="mudah">Mudah (+ - Ã—)</option> <option value="sedang">Sedang (+ - Ã— Ã·)</option> <option value="sulit">Sulit (+ - Ã— Ã· ^ âˆš)</option> </select>
         </div><button id="start-hitung-btn" class="w-full bg-white text-blue-600 font-bold py-3 rounded-xl hover:bg-blue-50 transition"> ğŸ® Mulai Hitung Cepat </button>
        </div><!-- Memory Game -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-2xl p-6">
         <h3 class="text-xl font-bold mb-2">ğŸ§  Memory Match</h3>
         <p class="text-sm opacity-90 mb-4">Cocokkan operasi dengan hasilnya!</p>
         <div class="mb-4"><label class="block text-sm font-medium mb-2">Level:</label> <select id="memory-level" class="w-full px-3 py-2 rounded-lg text-gray-800"> <option value="mudah">Mudah (4 pasang)</option> <option value="sedang">Sedang (6 pasang)</option> <option value="sulit">Sulit (8 pasang)</option> </select>
         </div><button id="start-memory-btn" class="w-full bg-white text-purple-600 font-bold py-3 rounded-xl hover:bg-purple-50 transition"> ğŸ® Mulai Memory Game </button>
        </div>
       </div><!-- Hitung Cepat Game Area -->
       <div id="hitung-game-area" class="hidden bg-gray-100 rounded-2xl p-6 mb-4">
        <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">Level: <span id="hitung-current-level"></span></span> <span class="text-sm font-medium text-gray-600">Waktu: <span id="hitung-timer" class="font-mono">60</span>s</span>
        </div>
        <div class="text-center mb-6">
         <div id="hitung-question" class="text-4xl font-bold text-gray-800 mb-4">
          5 + 3 = ?
         </div><input type="number" id="hitung-answer" class="w-32 px-4 py-3 text-2xl text-center rounded-xl border-2 border-gray-300 focus:border-amber-500 focus:outline-none" placeholder="?"> <button id="hitung-submit" class="ml-2 btn-primary text-white font-bold px-6 py-3 rounded-xl">Jawab</button>
        </div>
        <div class="flex justify-center gap-6"><span class="text-green-600 font-bold">âœ“ <span id="hitung-correct">0</span></span> <span class="text-red-600 font-bold">âœ— <span id="hitung-wrong">0</span></span>
        </div>
       </div><!-- Memory Game Area -->
       <div id="memory-game-area" class="hidden bg-gray-100 rounded-2xl p-6 mb-4">
        <div class="flex justify-between items-center mb-4"><span class="text-sm font-medium text-gray-600">Level: <span id="memory-current-level"></span></span> <span class="text-sm font-medium text-gray-600">Langkah: <span id="memory-moves">0</span></span>
        </div>
        <div id="memory-grid" class="grid gap-3 justify-center"></div>
        <div class="text-center mt-4"><span class="text-green-600 font-bold">Cocok: <span id="memory-matches">0</span></span>
        </div>
       </div><!-- Save Score --> <button id="save-math-btn" class="w-full btn-primary text-white font-bold py-3 rounded-xl mb-4"> ğŸ’¾ Simpan Skor Game </button> <!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-math" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div><!-- Statistik Tab -->
     <div id="tab-statistik" class="tab-content hidden pb-16">
      <div class="card-glass rounded-2xl p-6 shadow-xl">
       <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“ˆ Statistik &amp; Riwayat</h2><!-- Summary Stats -->
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-blue-600" id="stat-study-hours">
          0
         </div>
         <div class="text-sm text-blue-700">
          Jam Belajar
         </div>
        </div>
        <div class="bg-green-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-green-600" id="stat-latihan">
          0
         </div>
         <div class="text-sm text-green-700">
          Latihan Soal
         </div>
        </div>
        <div class="bg-amber-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-amber-600" id="stat-games">
          0
         </div>
         <div class="text-sm text-amber-700">
          Game Dimainkan
         </div>
        </div>
        <div class="bg-purple-100 rounded-xl p-4 text-center">
         <div class="text-3xl font-bold text-purple-600" id="stat-habits">
          0
         </div>
         <div class="text-sm text-purple-700">
          Habit Selesai
         </div>
        </div>
       </div><!-- History List -->
       <div class="mb-4">
        <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ“œ Riwayat Aktivitas</h3>
        <div class="flex gap-2 mb-4 flex-wrap"><button class="filter-btn bg-gray-800 text-white px-3 py-1 rounded-lg text-sm" data-filter="all">Semua</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="timer">Timer</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="latihan">Latihan</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="game">Game</button> <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="habit">Habit</button>
        </div>
        <div id="history-list" class="max-h-96 overflow-y-auto space-y-3 mb-4"></div>
       </div><!-- Footer -->
       <div class="bg-gradient-to-r from-amber-50 to-amber-100 rounded-2xl p-4 text-center text-sm">
        <p class="text-gray-700 mb-2">ğŸ“± Follow kami di Instagram</p>
        <p class="font-bold text-amber-600 mb-2">@ferdiansyah_ypf</p>
        <p class="text-xs text-gray-600 mb-2">Temukan produk bermanfaat lainnya:</p>
        <div class="flex gap-2"><a href="https://lynk.id/suksesbarengjalurlangit" target="_blank" rel="noopener noreferrer" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white px-2 py-1 rounded text-xs font-medium transition"> ğŸ”— Web </a> <button id="copy-url-stat" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-2 py-1 rounded text-xs font-medium transition"> ğŸ“‹ Copy </button>
        </div>
       </div>
      </div>
     </div>
    </main>
   </div>
  </div>
  <script>
    // App State
    let currentUser = null;
    let allData = [];
    let currentDailyHabits = [];
    let currentDailyMood = '';
    let timerInterval = null;
    let timerSeconds = 0;
    let countdownMode = false;
    let countdownTotal = 0;
    let latihanTimerInterval = null;
    let latihanSeconds = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let kataList = [];
    let vocabList = [];
    let kataGameScore = { correct: 0, wrong: 0 };
    let vocabGameScore = { correct: 0, wrong: 0 };
    let hitungGameActive = false;
    let hitungTimer = 60;
    let hitungInterval = null;
    let hitungScore = { correct: 0, wrong: 0 };
    let memoryCards = [];
    let memoryFlipped = [];
    let memoryMatched = [];
    let memoryMoves = 0;
    let currentFilter = 'all';

    const defaultConfig = {
      app_title: 'SNBT Fighter Journey'
    };

    const SNBT_START = new Date('2026-02-02');
    const SNBT_END = new Date('2026-04-21');
    const TOTAL_DAYS = 80;

    // Element SDK Init
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const title = config.app_title || defaultConfig.app_title;
          document.getElementById('app-title').textContent = title;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title]
        ])
      });
    }

    // Data SDK Init
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        updateUI();
      }
    };

    async function initDataSDK() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Gagal menginisialisasi data', 'error');
        }
      }
    }

    initDataSDK();

    // Toast Notification
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast px-4 py-3 rounded-lg shadow-lg mb-2 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-amber-500'} text-white font-medium`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Get Users/PINs
    function getUsers() {
      return allData.filter(d => d.type === 'user');
    }

    // Update UI based on data
    function updateUI() {
      updateStats();
      renderPinList();
    }

    // Render PIN List
    function renderPinList() {
      const container = document.getElementById('pins-list');
      const users = getUsers();
      
      if (users.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada PIN terdaftar</p>';
        return;
      }

      container.innerHTML = users.map(u => `
        <div class="bg-gray-100 rounded-lg p-3 flex justify-between items-center">
          <span class="font-medium text-gray-800">${u.username}</span>
          <span class="font-mono text-gray-500">****</span>
        </div>
      `).join('');
    }

    // Copy URL Function
    function copyToClipboard(url) {
      navigator.clipboard.writeText(url).then(() => {
        showToast('URL berhasil disalin!', 'success');
      }).catch(() => {
        showToast('Gagal menyalin URL', 'error');
      });
    }

    document.querySelectorAll('[id^="copy-url-"]').forEach(btn => {
      btn.addEventListener('click', () => {
        copyToClipboard('https://lynk.id/suksesbarengjalurlangit');
      });
    });

    // Login Functions
    document.getElementById('login-btn').addEventListener('click', async () => {
      const pin = document.getElementById('pin-input').value;
      const users = getUsers();
      const user = users.find(u => u.pin === pin);

      if (user) {
        currentUser = user;
        document.getElementById('user-welcome').textContent = `Halo, ${user.username}!`;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-dashboard').classList.remove('hidden');
        
        // Check notification permission
        if ('Notification' in window && Notification.permission === 'default') {
          document.getElementById('notification-banner').classList.remove('hidden');
        }
        
        initDashboard();
        document.getElementById('login-error').classList.add('hidden');
      } else {
        document.getElementById('login-error').textContent = 'PIN tidak valid!';
        document.getElementById('login-error').classList.remove('hidden');
      }
    });

    document.getElementById('enable-notifications-btn').addEventListener('click', () => {
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            showToast('Notifikasi berhasil diaktifkan!', 'success');
            document.getElementById('notification-banner').classList.add('hidden');
          }
        });
      }
    });

    // Show PINs
    document.getElementById('show-pins-btn').addEventListener('click', () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('view-pins').classList.remove('hidden');
      renderPinList();
    });

    document.getElementById('back-from-pins').addEventListener('click', () => {
      document.getElementById('view-pins').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
    });

    // Admin Panel
    document.getElementById('show-admin-btn').addEventListener('click', () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
    });

    document.getElementById('back-from-admin').addEventListener('click', () => {
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('pin-creation').classList.add('hidden');
      document.getElementById('verify-admin-btn').classList.remove('hidden');
      document.getElementById('admin-code').value = '';
    });

    document.getElementById('verify-admin-btn').addEventListener('click', () => {
      const code = document.getElementById('admin-code').value;
      if (code === '2399') {
        document.getElementById('pin-creation').classList.remove('hidden');
        document.getElementById('verify-admin-btn').classList.add('hidden');
        showToast('Verifikasi berhasil!', 'success');
      } else {
        showToast('Kode admin salah!', 'error');
      }
    });

    document.getElementById('create-pin-btn').addEventListener('click', async () => {
      const username = document.getElementById('new-username').value.trim();
      const pin = document.getElementById('new-pin').value.trim();

      if (!username || !pin || pin.length !== 4 || !/^\d+$/.test(pin)) {
        showToast('Username dan PIN 4 digit angka diperlukan!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'user',
        username: username,
        pin: pin,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('PIN berhasil dibuat!', 'success');
        document.getElementById('new-username').value = '';
        document.getElementById('new-pin').value = '';
      } else {
        showToast('Gagal membuat PIN', 'error');
      }
    });

    // Change PIN
    document.getElementById('change-pin-btn').addEventListener('click', () => {
      document.getElementById('change-pin-modal').classList.remove('hidden');
    });

    document.getElementById('cancel-change-pin').addEventListener('click', () => {
      document.getElementById('change-pin-modal').classList.add('hidden');
    });

    document.getElementById('save-change-pin').addEventListener('click', async () => {
      const oldPin = document.getElementById('old-pin-input').value;
      const newPin = document.getElementById('new-pin-change').value;

      if (oldPin !== currentUser.pin) {
        showToast('PIN lama salah!', 'error');
        return;
      }

      if (newPin.length !== 4 || !/^\d+$/.test(newPin)) {
        showToast('PIN baru harus 4 digit angka!', 'error');
        return;
      }

      const updatedUser = { ...currentUser, pin: newPin };
      const result = await window.dataSdk.update(updatedUser);

      if (result.isOk) {
        currentUser = updatedUser;
        showToast('PIN berhasil diubah!', 'success');
        document.getElementById('change-pin-modal').classList.add('hidden');
        document.getElementById('old-pin-input').value = '';
        document.getElementById('new-pin-change').value = '';
      } else {
        showToast('Gagal mengubah PIN', 'error');
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('main-dashboard').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('pin-input').value = '';
      resetTimers();
    });

    // Tab Navigation
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('tab-active');
          b.classList.add('text-gray-600');
        });
        btn.classList.add('tab-active');
        btn.classList.remove('text-gray-600');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`tab-${btn.dataset.tab}`).classList.remove('hidden');
      });
    });

    // Initialize Dashboard
    function initDashboard() {
      updateCountdown();
      setInterval(updateCountdown, 1000);
      renderMiniCalendar();
      initHabitDatePicker();
    }

    // Countdown
    function updateCountdown() {
      const snbtDate = new Date('2026-04-21T00:00:00');
      const now = new Date();
      const diff = snbtDate - now;

      if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('countdown-days').textContent = days;
        document.getElementById('countdown-hours').textContent = hours;
        document.getElementById('countdown-minutes').textContent = minutes;
        document.getElementById('countdown-seconds').textContent = seconds;
      }

      // Progress calculation
      const totalDays = (SNBT_END - SNBT_START) / (1000 * 60 * 60 * 24);
      const passedDays = Math.max(0, (now - SNBT_START) / (1000 * 60 * 60 * 24));
      const progress = Math.min(100, Math.max(0, (passedDays / totalDays) * 100));
      
      document.getElementById('progress-percent').textContent = `${progress.toFixed(1)}%`;
      document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    // Mini Calendar (Days 1-80)
    function renderMiniCalendar() {
      const grid = document.getElementById('mini-calendar');
      grid.innerHTML = '';

      for (let day = 1; day <= TOTAL_DAYS; day++) {
        const dateObj = new Date(SNBT_START);
        dateObj.setDate(dateObj.getDate() + day - 1);
        const dateStr = dateObj.toISOString().split('T')[0];
        
        const hasHabit = allData.some(d => d.type === 'habit' && d.date === dateStr && d.username === currentUser?.username);
        const isToday = dateStr === new Date().toISOString().split('T')[0];

        const dayEl = document.createElement('div');
        dayEl.className = `calendar-mini-day cursor-pointer ${isToday ? 'bg-amber-400 text-white font-bold ring-2 ring-amber-600' : hasHabit ? 'bg-green-400 text-white font-bold' : 'bg-gray-200 text-gray-700'} hover:scale-110 transition-transform`;
        dayEl.textContent = day;
        dayEl.title = dateStr;
        
        dayEl.addEventListener('click', () => {
          document.getElementById('habit-date-input').value = dateStr;
          selectedHabitDate = dateStr;
          isViewingMode = true;
          updateHabitDateDisplay();
          loadDailyHabit();
          document.querySelector('[data-tab="dashboard"]').click();
          showToast(`ğŸ“… Menampilkan habit: ${dateStr}`, 'success');
        });

        grid.appendChild(dayEl);
      }
    }

    // Daily Habits (saved once per day)
    let selectedHabitDate = new Date().toISOString().split('T')[0];
    let isViewingMode = false;

    function initHabitDatePicker() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('habit-date-input').value = today;
      selectedHabitDate = today;
      updateHabitDateDisplay();
      loadDailyHabit();
    }

    function updateHabitDateDisplay() {
      const dateObj = new Date(selectedHabitDate + 'T00:00:00');
      const dateStr = dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      document.getElementById('habit-date-display').textContent = `Menampilkan habit: ${dateStr}`;
    }

    document.getElementById('habit-date-input').addEventListener('change', (e) => {
      selectedHabitDate = e.target.value;
      isViewingMode = true;
      updateHabitDateDisplay();
      loadDailyHabit();
    });

    document.getElementById('view-habit-btn').addEventListener('click', () => {
      const dateInput = document.getElementById('habit-date-input').value;
      if (dateInput) {
        selectedHabitDate = dateInput;
        isViewingMode = true;
        updateHabitDateDisplay();
        loadDailyHabit();
      }
    });

    document.getElementById('today-habit-btn').addEventListener('click', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('habit-date-input').value = today;
      selectedHabitDate = today;
      isViewingMode = false;
      updateHabitDateDisplay();
      loadDailyHabit();
    });

    document.getElementById('add-daily-habit-btn').addEventListener('click', () => {
      if (isViewingMode && selectedHabitDate !== new Date().toISOString().split('T')[0]) {
        showToast('Hanya bisa menambah habit hari ini!', 'error');
        return;
      }

      const text = document.getElementById('new-habit-input').value.trim();
      const time = document.getElementById('habit-time-input').value;
      
      if (text) {
        currentDailyHabits.push({ text, time, done: false, id: Date.now() });
        renderDailyHabits();
        document.getElementById('new-habit-input').value = '';
        document.getElementById('habit-time-input').value = '';
      }
    });

    function renderDailyHabits() {
      const container = document.getElementById('daily-habits-list');
      if (currentDailyHabits.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm py-2">Belum ada habit</p>';
        return;
      }

      container.innerHTML = currentDailyHabits.map((h, i) => `
        <div class="flex items-center gap-2 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-3 border-l-4 border-blue-500">
          <input type="checkbox" ${h.done ? 'checked' : ''} onchange="toggleDailyHabit(${i})" class="w-4 h-4 text-amber-500 rounded cursor-pointer">
          <div class="flex-1">
            <span class="${h.done ? 'line-through text-gray-400' : 'text-gray-800'} font-medium text-sm">${h.text}</span>
            ${h.time ? `<span class="text-xs text-gray-500 ml-2">ğŸ• ${h.time}</span>` : ''}
          </div>
          <button onclick="deleteDailyHabit(${i})" class="text-red-400 hover:text-red-600 text-sm font-bold transition">Ã—</button>
        </div>
      `).join('');
    }

    window.toggleDailyHabit = function(index) {
      currentDailyHabits[index].done = !currentDailyHabits[index].done;
      renderDailyHabits();
    };

    window.deleteDailyHabit = function(index) {
      currentDailyHabits.splice(index, 1);
      renderDailyHabits();
    };

    // Mood Selection
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentDailyMood = btn.dataset.mood;
        updateMoodUI();
      });
    });

    function updateMoodUI() {
      document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.toggle('bg-amber-200', btn.dataset.mood === currentDailyMood);
      });
      document.getElementById('selected-mood').textContent = currentDailyMood ? `Mood: ${currentDailyMood}` : '';
    }

    // Load today's habit
    function loadDailyHabit() {
      const targetDate = selectedHabitDate || new Date().toISOString().split('T')[0];
      const targetHabit = allData.find(d => d.type === 'habit' && d.date === targetDate && d.username === currentUser?.username);
      
      if (targetHabit) {
        currentDailyHabits = JSON.parse(targetHabit.habits || '[]');
        currentDailyMood = targetHabit.mood || '';
      } else {
        currentDailyHabits = [];
        currentDailyMood = '';
      }
      
      renderDailyHabits();
      updateMoodUI();
    }

    // Save Daily Habit
    document.getElementById('save-daily-habit-btn').addEventListener('click', async () => {
      if (isViewingMode && selectedHabitDate !== new Date().toISOString().split('T')[0]) {
        showToast('Hanya bisa menyimpan habit hari ini!', 'error');
        return;
      }

      const saveDate = selectedHabitDate || new Date().toISOString().split('T')[0];
      
      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const existingHabit = allData.find(d => d.type === 'habit' && d.date === saveDate && d.username === currentUser.username);

      if (existingHabit) {
        const updated = {
          ...existingHabit,
          habits: JSON.stringify(currentDailyHabits),
          mood: currentDailyMood
        };
        const result = await window.dataSdk.update(updated);
        if (result.isOk) {
          showToast('âœ“ Habit berhasil diperbarui!', 'success');
          renderMiniCalendar();
          scheduleAllNotifications();
        }
      } else {
        const result = await window.dataSdk.create({
          type: 'habit',
          username: currentUser.username,
          date: saveDate,
          habits: JSON.stringify(currentDailyHabits),
          mood: currentDailyMood,
          createdAt: new Date().toISOString()
        });
        if (result.isOk) {
          showToast('âœ“ Habit berhasil disimpan!', 'success');
          renderMiniCalendar();
          scheduleAllNotifications();
        }
      }
    });

    function scheduleAllNotifications() {
      if (!('Notification' in window)) {
        showToast('âš ï¸ Browser tidak mendukung notifikasi', 'error');
        return;
      }

      if (Notification.permission !== 'granted') {
        showToast('ğŸ“³ Aktifkan notifikasi terlebih dahulu di banner atas', 'error');
        return;
      }

      currentDailyHabits.forEach(habit => {
        if (habit.time) {
          scheduleNotification(habit.text, habit.time, selectedHabitDate);
        }
      });

      showToast('âœ“ Notifikasi dijadwalkan untuk habit hari ini', 'success');
    }

    let notificationTimeouts = [];

    function scheduleNotification(habitText, time, habitDate) {
      const [hours, minutes] = time.split(':');
      const scheduleTime = new Date(habitDate + 'T' + hours + ':' + minutes + ':00');
      const now = new Date();
      
      const diff = scheduleTime - now;
      
      if (diff > 0) {
        const timeoutId = setTimeout(() => {
          // Buat notifikasi
          new Notification('ğŸ¯ SNBT Fighter - Reminder Habit', {
            body: `Waktunya: ${habitText}`,
            icon: 'ğŸ¯',
            tag: 'snbt-habit-' + Date.now(),
            requireInteraction: true,
            silent: false
          });
          
          // Hapus dari array
          notificationTimeouts = notificationTimeouts.filter(t => t.id !== timeoutId);
        }, diff);

        // Simpan timeout ID untuk referensi
        notificationTimeouts.push({ id: timeoutId, habit: habitText });
      } else {
        // Jika waktu sudah lewat, kirim notifikasi segera
        new Notification('ğŸ¯ SNBT Fighter - Reminder Habit', {
          body: `Waktunya: ${habitText} (jadwal sudah lewat, jalankan sekarang!)`,
          icon: 'ğŸ¯',
          tag: 'snbt-habit-' + Date.now(),
          requireInteraction: true,
          silent: false
        });
      }
    }

    // Timer Functions
    function formatTime(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return { h, m, s };
    }

    function updateTimerDisplay() {
      const { h, m, s } = formatTime(timerSeconds);
      document.getElementById('timer-hours').textContent = String(h).padStart(2, '0');
      document.getElementById('timer-minutes').textContent = String(m).padStart(2, '0');
      document.getElementById('timer-seconds').textContent = String(s).padStart(2, '0');
    }

    // Set Countdown Timer
    document.getElementById('set-timer-btn').addEventListener('click', () => {
      const hours = parseInt(document.getElementById('timer-hours-input').value) || 0;
      const minutes = parseInt(document.getElementById('timer-minutes-input').value) || 0;
      const seconds = parseInt(document.getElementById('timer-seconds-input').value) || 0;

      countdownTotal = hours * 3600 + minutes * 60 + seconds;
      timerSeconds = countdownTotal;
      countdownMode = true;

      document.getElementById('timer-mode-label').textContent = 'Timer Hitung Mundur';
      updateTimerDisplay();
      showToast(`Timer diatur: ${hours}j ${minutes}m ${seconds}d`, 'success');
    });

    document.getElementById('timer-start').addEventListener('click', () => {
      if (!timerInterval) {
        timerInterval = setInterval(() => {
          if (countdownMode) {
            if (timerSeconds > 0) {
              timerSeconds--;
            } else {
              clearInterval(timerInterval);
              timerInterval = null;
              if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('â° Timer Habis!', {
                  body: 'Waktu belajar Anda sudah habis',
                  icon: 'â°'
                });
              }
              showToast('â° Timer habis!', 'success');
              countdownMode = false;
            }
          } else {
            timerSeconds++;
          }
          updateTimerDisplay();
        }, 1000);
      }
    });

    document.getElementById('timer-pause').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
    });

    document.getElementById('timer-reset').addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
      if (countdownMode) {
        timerSeconds = countdownTotal;
      } else {
        timerSeconds = 0;
      }
      countdownMode = false;
      document.getElementById('timer-mode-label').textContent = 'Timer Hitung Maju';
      updateTimerDisplay();
    });

    document.getElementById('save-timer-btn').addEventListener('click', async () => {
      const subject = document.getElementById('timer-subject').value;
      const notes = document.getElementById('timer-notes').value;

      if (!subject) {
        showToast('Pilih mata pelajaran!', 'error');
        return;
      }

      if (timerSeconds === 0) {
        showToast('Timer belum berjalan!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'timer',
        username: currentUser.username,
        subject: subject,
        duration: timerSeconds,
        notes: notes,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Sesi belajar disimpan!', 'success');
        timerSeconds = 0;
        countdownMode = false;
        updateTimerDisplay();
        document.getElementById('timer-notes').value = '';
      }
    });

    // Latihan Functions
    function updateLatihanTimer() {
      const m = Math.floor(latihanSeconds / 60);
      const s = latihanSeconds % 60;
      document.getElementById('latihan-timer-min').textContent = String(m).padStart(2, '0');
      document.getElementById('latihan-timer-sec').textContent = String(s).padStart(2, '0');
    }

    document.getElementById('latihan-start').addEventListener('click', () => {
      if (!latihanTimerInterval) {
        latihanTimerInterval = setInterval(() => {
          latihanSeconds++;
          updateLatihanTimer();
        }, 1000);
      }
    });

    document.getElementById('latihan-pause').addEventListener('click', () => {
      clearInterval(latihanTimerInterval);
      latihanTimerInterval = null;
    });

    document.getElementById('latihan-reset').addEventListener('click', () => {
      clearInterval(latihanTimerInterval);
      latihanTimerInterval = null;
      latihanSeconds = 0;
      updateLatihanTimer();
    });

    document.getElementById('correct-plus').addEventListener('click', () => {
      correctCount++;
      document.getElementById('latihan-correct').textContent = correctCount;
    });

    document.getElementById('correct-minus').addEventListener('click', () => {
      if (correctCount > 0) correctCount--;
      document.getElementById('latihan-correct').textContent = correctCount;
    });

    document.getElementById('wrong-plus').addEventListener('click', () => {
      wrongCount++;
      document.getElementById('latihan-wrong').textContent = wrongCount;
    });

    document.getElementById('wrong-minus').addEventListener('click', () => {
      if (wrongCount > 0) wrongCount--;
      document.getElementById('latihan-wrong').textContent = wrongCount;
    });

    document.getElementById('save-latihan-btn').addEventListener('click', async () => {
      const subject = document.getElementById('latihan-subject').value;
      const notes = document.getElementById('latihan-notes').value;

      if (!subject) {
        showToast('Pilih mata pelajaran!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const result = await window.dataSdk.create({
        type: 'latihan',
        username: currentUser.username,
        subject: subject,
        duration: latihanSeconds,
        correct: correctCount,
        wrong: wrongCount,
        notes: notes,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Latihan disimpan!', 'success');
        latihanSeconds = 0;
        correctCount = 0;
        wrongCount = 0;
        updateLatihanTimer();
        document.getElementById('latihan-correct').textContent = '0';
        document.getElementById('latihan-wrong').textContent = '0';
        document.getElementById('latihan-notes').value = '';
      }
    });

    // Game Kata
    document.getElementById('add-kata-btn').addEventListener('click', () => {
      const baku = document.getElementById('kata-baku-input').value.trim();
      const tidakBaku = document.getElementById('kata-tidak-baku-input').value.trim();

      if (baku && tidakBaku) {
        kataList.push({ baku, tidakBaku });
        renderKataList();
        document.getElementById('kata-baku-input').value = '';
        document.getElementById('kata-tidak-baku-input').value = '';
      }
    });

    function renderKataList() {
      const container = document.getElementById('kata-list');
      if (kataList.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm">Belum ada kata</p>';
        return;
      }

      container.innerHTML = kataList.map((k, i) => `
        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2 text-sm">
          <span class="text-green-600 font-medium">${k.baku}</span>
          <span class="text-gray-400">vs</span>
          <span class="text-red-500">${k.tidakBaku}</span>
          <button onclick="deleteKata(${i})" class="text-red-400 hover:text-red-600 ml-2">Ã—</button>
        </div>
      `).join('');
    }

    window.deleteKata = function(index) {
      kataList.splice(index, 1);
      renderKataList();
    };

    document.getElementById('play-kata-btn').addEventListener('click', () => {
      if (kataList.length < 2) {
        showToast('Tambahkan minimal 2 kata!', 'error');
        return;
      }
      document.getElementById('kata-game-area').classList.remove('hidden');
      kataGameScore = { correct: 0, wrong: 0 };
      nextKataQuestion();
    });

    function nextKataQuestion() {
      const random = kataList[Math.floor(Math.random() * kataList.length)];
      const options = Math.random() > 0.5 ? [random.baku, random.tidakBaku] : [random.tidakBaku, random.baku];
      
      document.getElementById('kata-question').textContent = 'Pilih kata yang BAKU:';
      document.getElementById('kata-options').innerHTML = options.map(opt => `
        <button onclick="checkKata('${opt}', '${random.baku}')" class="bg-white hover:bg-amber-100 border-2 border-gray-200 px-4 py-2 rounded-lg font-medium transition">${opt}</button>
      `).join('');
    }

    window.checkKata = function(selected, correct) {
      if (selected === correct) {
        kataGameScore.correct++;
        showToast('Benar! ğŸ‰', 'success');
      } else {
        kataGameScore.wrong++;
        showToast(`Salah! Jawaban: ${correct}`, 'error');
      }
      document.getElementById('kata-score-correct').textContent = kataGameScore.correct;
      document.getElementById('kata-score-wrong').textContent = kataGameScore.wrong;
      setTimeout(nextKataQuestion, 1000);
    };

    // Vocabulary Game
    document.getElementById('add-vocab-btn').addEventListener('click', () => {
      const eng = document.getElementById('vocab-eng-input').value.trim();
      const ind = document.getElementById('vocab-ind-input').value.trim();

      if (eng && ind) {
        vocabList.push({ eng, ind });
        renderVocabList();
        document.getElementById('vocab-eng-input').value = '';
        document.getElementById('vocab-ind-input').value = '';
      }
    });

    function renderVocabList() {
      const container = document.getElementById('vocab-list');
      if (vocabList.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center text-sm">Belum ada kosakata</p>';
        return;
      }

      container.innerHTML = vocabList.map((v, i) => `
        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-2 text-sm">
          <span class="text-blue-600 font-medium">${v.eng}</span>
          <span class="text-gray-400">=</span>
          <span class="text-green-600">${v.ind}</span>
          <button onclick="deleteVocab(${i})" class="text-red-400 hover:text-red-600 ml-2">Ã—</button>
        </div>
      `).join('');
    }

    window.deleteVocab = function(index) {
      vocabList.splice(index, 1);
      renderVocabList();
    };

    document.getElementById('play-vocab-btn').addEventListener('click', () => {
      if (vocabList.length < 3) {
        showToast('Tambahkan minimal 3 kosakata!', 'error');
        return;
      }
      document.getElementById('vocab-game-area').classList.remove('hidden');
      vocabGameScore = { correct: 0, wrong: 0 };
      nextVocabQuestion();
    });

    function nextVocabQuestion() {
      const correct = vocabList[Math.floor(Math.random() * vocabList.length)];
      const wrongOptions = vocabList.filter(v => v !== correct).sort(() => Math.random() - 0.5).slice(0, 2);
      const options = [...wrongOptions.map(w => w.ind), correct.ind].sort(() => Math.random() - 0.5);

      document.getElementById('vocab-question').textContent = correct.eng;
      document.getElementById('vocab-options').innerHTML = options.map(opt => `
        <button onclick="checkVocab('${opt}', '${correct.ind}')" class="bg-white hover:bg-blue-100 border-2 border-gray-200 px-4 py-2 rounded-lg font-medium transition">${opt}</button>
      `).join('');
    }

    window.checkVocab = function(selected, correct) {
      if (selected === correct) {
        vocabGameScore.correct++;
        showToast('Correct! ğŸ‰', 'success');
      } else {
        vocabGameScore.wrong++;
        showToast(`Wrong! Answer: ${correct}`, 'error');
      }
      document.getElementById('vocab-score-correct').textContent = vocabGameScore.correct;
      document.getElementById('vocab-score-wrong').textContent = vocabGameScore.wrong;
      setTimeout(nextVocabQuestion, 1000);
    };

    // Math Games
    document.getElementById('start-hitung-btn').addEventListener('click', () => {
      const level = document.getElementById('hitung-level').value;
      document.getElementById('hitung-game-area').classList.remove('hidden');
      document.getElementById('hitung-current-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
      hitungScore = { correct: 0, wrong: 0 };
      hitungTimer = 60;
      hitungGameActive = true;
      document.getElementById('hitung-timer').textContent = hitungTimer;
      document.getElementById('hitung-correct').textContent = '0';
      document.getElementById('hitung-wrong').textContent = '0';
      generateHitungQuestion(level);
      
      hitungInterval = setInterval(() => {
        hitungTimer--;
        document.getElementById('hitung-timer').textContent = hitungTimer;
        if (hitungTimer <= 0) {
          clearInterval(hitungInterval);
          hitungGameActive = false;
          showToast(`Waktu habis! Benar: ${hitungScore.correct}, Salah: ${hitungScore.wrong}`, 'success');
        }
      }, 1000);
    });

    function generateHitungQuestion(level) {
      let a, b, op, answer;
      const ops = level === 'mudah' ? ['+', '-', 'Ã—'] : level === 'sedang' ? ['+', '-', 'Ã—', 'Ã·'] : ['+', '-', 'Ã—', 'Ã·', '^', 'âˆš'];
      op = ops[Math.floor(Math.random() * ops.length)];

      switch(op) {
        case '+':
          a = Math.floor(Math.random() * 50) + 1;
          b = Math.floor(Math.random() * 50) + 1;
          answer = a + b;
          break;
        case '-':
          a = Math.floor(Math.random() * 50) + 20;
          b = Math.floor(Math.random() * 20) + 1;
          answer = a - b;
          break;
        case 'Ã—':
          a = Math.floor(Math.random() * 12) + 1;
          b = Math.floor(Math.random() * 12) + 1;
          answer = a * b;
          break;
        case 'Ã·':
          b = Math.floor(Math.random() * 10) + 1;
          answer = Math.floor(Math.random() * 10) + 1;
          a = b * answer;
          break;
        case '^':
          a = Math.floor(Math.random() * 10) + 2;
          b = 2;
          answer = Math.pow(a, b);
          break;
        case 'âˆš':
          answer = Math.floor(Math.random() * 10) + 2;
          a = answer * answer;
          b = null;
          break;
      }

      const questionText = b !== null ? `${a} ${op} ${b} = ?` : `âˆš${a} = ?`;
      document.getElementById('hitung-question').textContent = questionText;
      document.getElementById('hitung-answer').value = '';
      document.getElementById('hitung-answer').dataset.answer = answer;
    }

    document.getElementById('hitung-submit').addEventListener('click', () => {
      if (!hitungGameActive) return;
      
      const userAnswer = parseInt(document.getElementById('hitung-answer').value);
      const correctAnswer = parseInt(document.getElementById('hitung-answer').dataset.answer);

      if (userAnswer === correctAnswer) {
        hitungScore.correct++;
        document.getElementById('hitung-correct').textContent = hitungScore.correct;
      } else {
        hitungScore.wrong++;
        document.getElementById('hitung-wrong').textContent = hitungScore.wrong;
      }

      generateHitungQuestion(document.getElementById('hitung-level').value);
    });

    document.getElementById('hitung-answer').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('hitung-submit').click();
    });

    // Memory Game
    document.getElementById('start-memory-btn').addEventListener('click', () => {
      const level = document.getElementById('memory-level').value;
      document.getElementById('memory-game-area').classList.remove('hidden');
      document.getElementById('memory-current-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
      initMemoryGame(level);
    });

    function initMemoryGame(level) {
      const pairs = level === 'mudah' ? 4 : level === 'sedang' ? 6 : 8;
      memoryCards = [];
      memoryFlipped = [];
      memoryMatched = [];
      memoryMoves = 0;

      const operations = [];
      for (let i = 0; i < pairs; i++) {
        let a, b, op, result;
        const opTypes = ['+', '-', 'Ã—', 'Ã·'];
        op = opTypes[Math.floor(Math.random() * opTypes.length)];

        switch(op) {
          case '+':
            a = Math.floor(Math.random() * 10) + 1;
            b = Math.floor(Math.random() * 10) + 1;
            result = a + b;
            break;
          case '-':
            a = Math.floor(Math.random() * 10) + 10;
            b = Math.floor(Math.random() * 10) + 1;
            result = a - b;
            break;
          case 'Ã—':
            a = Math.floor(Math.random() * 5) + 1;
            b = Math.floor(Math.random() * 5) + 1;
            result = a * b;
            break;
          case 'Ã·':
            b = Math.floor(Math.random() * 5) + 1;
            result = Math.floor(Math.random() * 5) + 1;
            a = b * result;
            break;
        }

        operations.push({ text: `${a} ${op} ${b}`, pairId: i, isOp: true });
        operations.push({ text: `${result}`, pairId: i, isOp: false });
      }

      memoryCards = operations.sort(() => Math.random() - 0.5);
      renderMemoryGrid(pairs);
    }

    function renderMemoryGrid(pairs) {
      const grid = document.getElementById('memory-grid');
      const cols = pairs <= 4 ? 4 : pairs <= 6 ? 4 : 4;
      grid.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;

      grid.innerHTML = memoryCards.map((card, i) => `
        <div class="flip-card w-20 h-20 cursor-pointer" data-index="${i}" onclick="flipCard(${i})">
          <div class="flip-card-inner relative w-full h-full">
            <div class="flip-card-front absolute w-full h-full bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center text-white text-2xl font-bold">?</div>
            <div class="flip-card-back absolute w-full h-full bg-white rounded-xl flex items-center justify-center text-gray-800 font-bold text-sm border-2 border-purple-300 p-1 text-center">${card.text}</div>
          </div>
        </div>
      `).join('');

      document.getElementById('memory-moves').textContent = '0';
      document.getElementById('memory-matches').textContent = '0';
    }

    window.flipCard = function(index) {
      if (memoryFlipped.length >= 2 || memoryFlipped.includes(index) || memoryMatched.includes(index)) return;

      const card = document.querySelectorAll('.flip-card')[index];
      card.classList.add('flipped');
      memoryFlipped.push(index);

      if (memoryFlipped.length === 2) {
        memoryMoves++;
        document.getElementById('memory-moves').textContent = memoryMoves;

        const [first, second] = memoryFlipped;
        if (memoryCards[first].pairId === memoryCards[second].pairId) {
          memoryMatched.push(first, second);
          document.getElementById('memory-matches').textContent = memoryMatched.length / 2;
          memoryFlipped = [];

          if (memoryMatched.length === memoryCards.length) {
            showToast(`Selamat! Selesai dalam ${memoryMoves} langkah!`, 'success');
          }
        } else {
          setTimeout(() => {
            document.querySelectorAll('.flip-card')[first].classList.remove('flipped');
            document.querySelectorAll('.flip-card')[second].classList.remove('flipped');
            memoryFlipped = [];
          }, 1000);
        }
      }
    };

    // Save Math Game
    document.getElementById('save-math-btn').addEventListener('click', async () => {
      const hitungActive = !document.getElementById('hitung-game-area').classList.contains('hidden');
      const memoryActive = !document.getElementById('memory-game-area').classList.contains('hidden');

      if (!hitungActive && !memoryActive) {
        showToast('Mainkan game terlebih dahulu!', 'error');
        return;
      }

      if (allData.length >= 999) {
        showToast('Batas data tercapai!', 'error');
        return;
      }

      const gameType = hitungActive ? 'hitung_cepat' : 'memory';
      const score = hitungActive ? hitungScore.correct : memoryMatched.length / 2;
      const level = hitungActive ? document.getElementById('hitung-level').value : document.getElementById('memory-level').value;

      const result = await window.dataSdk.create({
        type: 'game',
        username: currentUser.username,
        gameType: gameType,
        level: level,
        score: score,
        correct: hitungActive ? hitungScore.correct : memoryMatched.length / 2,
        wrong: hitungActive ? hitungScore.wrong : memoryMoves - (memoryMatched.length / 2),
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        showToast('Skor game disimpan!', 'success');
      }
    });

    // Statistics & History
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => {
          b.classList.remove('bg-gray-800', 'text-white');
          b.classList.add('bg-gray-200', 'text-gray-700');
        });
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-gray-800', 'text-white');
        currentFilter = btn.dataset.filter;
        renderHistory();
      });
    });

    function updateStats() {
      if (!currentUser) return;

      const timerSessions = allData.filter(d => d.type === 'timer' && d.username === currentUser.username);
      const latihanSessions = allData.filter(d => d.type === 'latihan' && d.username === currentUser.username);
      const gameSessions = allData.filter(d => d.type === 'game' && d.username === currentUser.username);
      const habitSessions = allData.filter(d => d.type === 'habit' && d.username === currentUser.username);

      const totalStudySeconds = timerSessions.reduce((sum, s) => sum + (s.duration || 0), 0);
      const totalHabitsDone = habitSessions.reduce((sum, h) => {
        const habits = JSON.parse(h.habits || '[]');
        return sum + habits.filter(hh => hh.done).length;
      }, 0);

      document.getElementById('stat-study-hours').textContent = (totalStudySeconds / 3600).toFixed(1);
      document.getElementById('stat-latihan').textContent = latihanSessions.length;
      document.getElementById('stat-games').textContent = gameSessions.length;
      document.getElementById('stat-habits').textContent = totalHabitsDone;

      renderHistory();
    }

    function renderHistory() {
      if (!currentUser) return;

      const container = document.getElementById('history-list');
      let filtered = allData.filter(d => d.username === currentUser.username && d.type !== 'user');

      if (currentFilter !== 'all') {
        filtered = filtered.filter(d => d.type === currentFilter);
      }

      filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">Belum ada riwayat</p>';
        return;
      }

      container.innerHTML = filtered.map(item => {
        const date = new Date(item.createdAt).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        let content = '';
        let icon = '';
        let bgColor = '';

        switch(item.type) {
          case 'timer':
            icon = 'â±ï¸';
            bgColor = 'bg-blue-50 border-blue-200';
            const { h, m, s } = formatTime(item.duration);
            content = `<strong>${item.subject}</strong><br>Durasi: ${h}j ${m}m ${s}d${item.notes ? `<br><small class="text-gray-500">${item.notes.substring(0, 50)}...</small>` : ''}`;
            break;
          case 'latihan':
            icon = 'ğŸ“';
            bgColor = 'bg-green-50 border-green-200';
            content = `<strong>${item.subject}</strong><br>âœ“ ${item.correct} Benar | âœ— ${item.wrong} Salah`;
            break;
          case 'game':
            icon = 'ğŸ®';
            bgColor = 'bg-amber-50 border-amber-200';
            content = `<strong>${item.gameType === 'hitung_cepat' ? 'Hitung Cepat' : 'Memory Match'}</strong><br>Level: ${item.level} | Skor: ${item.score}`;
            break;
          case 'habit':
            icon = 'ğŸ“‹';
            bgColor = 'bg-purple-50 border-purple-200';
            const habits = JSON.parse(item.habits || '[]');
            const done = habits.filter(h => h.done).length;
            content = `<strong>Habit ${item.date}</strong><br>${done}/${habits.length} selesai ${item.mood ? `| Mood: ${item.mood}` : ''}`;
            break;
        }

        return `
          <div class="${bgColor} border rounded-xl p-4">
            <div class="flex items-start gap-3">
              <span class="text-2xl">${icon}</span>
              <div class="flex-1">
                <div class="text-sm text-gray-800">${content}</div>
                <div class="text-xs text-gray-400 mt-1">${date}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function resetTimers() {
      clearInterval(timerInterval);
      clearInterval(latihanTimerInterval);
      clearInterval(hitungInterval);
      timerInterval = null;
      latihanTimerInterval = null;
      hitungInterval = null;
      timerSeconds = 0;
      latihanSeconds = 0;
      countdownMode = false;
    }

    // Initial render
    renderKataList();
    renderVocabList();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ca93866f63bfd74',t:'MTc3MDUzMzcxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>